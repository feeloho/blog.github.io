<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>feeloho的博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.qazhe.com/"/>
  <updated>2020-04-23T07:12:37.314Z</updated>
  <id>https://www.qazhe.com/</id>
  
  <author>
    <name>feeloho</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Haproxy + RabbitMQ集群 Centos搭建及使用</title>
    <link href="https://www.qazhe.com/2020/04/23/Haproxy-RabbitMQ%E9%9B%86%E7%BE%A4-Centos%E6%90%AD%E5%BB%BA%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.qazhe.com/2020/04/23/Haproxy-RabbitMQ集群-Centos搭建及使用/</id>
    <published>2020-04-23T02:04:27.000Z</published>
    <updated>2020-04-23T07:12:37.314Z</updated>
    
    <content type="html"><![CDATA[<p>RabbitMQ是一个免费的开源企业消息代理软件。 它是用Erlang编写的，并实现了高级消息队列协议（AMQP）。 它提供所有主要编程语言的客户端库。 它支持多种消息传递协议，消息队列，传送确认，灵活的路由到队列，多种交换类型。 它还提供易于使用的HTTP-API，<a href="https://www.linuxcool.com/" target="_blank" rel="noopener">命令</a>行工具和用于管理RabbitMQ的Web UI；在本教程中，我们将在<a href="https://www.linuxprobe.com/" target="_blank" rel="noopener">CentOS</a> 7服务器上安装RabbitMQ。</p><a id="more"></a><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Centos7</li><li>Erlang 22.3</li><li>RabbitMQ 3.8.3</li><li>Haproxy 1.5.18</li></ul><h3 id="网络拓扑图"><a href="#网络拓扑图" class="headerlink" title="网络拓扑图"></a>网络拓扑图</h3><p><img src="https://raw.githubusercontent.com/feeloho/image_store/master/img/20200423101412.png" alt="网络拓扑图"></p><h3 id="安装Erlang"><a href="#安装Erlang" class="headerlink" title="安装Erlang"></a>安装Erlang</h3><p>Erlang安装包官网下载地址：<a href="https://www.erlang.org/downloads" target="_blank" rel="noopener">https://www.erlang.org/downloads</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://erlang.org/download/otp_src_22.3.tar.gz</span><br><span class="line">tar -zxvf otp_src_22.3.tar.gz</span><br><span class="line">cd otp_src_22.3</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>到此，Erlang安装完成，直接输入erl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iz7ejqa3pg6fglz ~]<span class="comment"># erl</span></span><br><span class="line">Erlang/OTP 22 [erts-10.7] [<span class="built_in">source</span>] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:1] [hipe]</span><br><span class="line"></span><br><span class="line">Eshell V10.7  (abort with ^G)</span><br><span class="line">1&gt;</span><br></pre></td></tr></table></figure><h3 id="安装RabbitMQ-Server"><a href="#安装RabbitMQ-Server" class="headerlink" title="安装RabbitMQ Server"></a>安装RabbitMQ Server</h3><p>RabbitMQ官方下载地址：<a href="https://www.rabbitmq.com/install-rpm.html#downloads" target="_blank" rel="noopener">https://www.rabbitmq.com/install-rpm.html#downloads</a></p><p>我这里选择<code>RPM for RHEL Linux 7.x, CentOS 7.x, Fedora 24+ (supports systemd)</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-3.8.3-1.el7.noarch.rpm</span><br><span class="line"><span class="comment">#如果提示erlang &gt;= 21.3 is needed by之类的信息，则试试在后面加上：--nodeps</span></span><br><span class="line"><span class="comment">#启动rabbitmq-server</span></span><br><span class="line">systemctl start rabbitmq-server</span><br><span class="line"><span class="comment"># 后台启动rabbitmq服务</span></span><br><span class="line">rabbitmq-server -detached</span><br><span class="line"><span class="comment">#查看状态</span></span><br><span class="line">rabbitmqctl status</span><br><span class="line"><span class="comment">#列出用户</span></span><br><span class="line">rabbitmqctl list_users</span><br><span class="line"><span class="comment">#添加用户</span></span><br><span class="line">rabbitmqctl  add_user admin admin</span><br><span class="line"><span class="comment">#设置用户类型</span></span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line"><span class="comment">#重启rabbitmq-server</span></span><br><span class="line">systemctl restart rabbitmq-server</span><br><span class="line"><span class="comment">#开启远程管理界面插件</span></span><br><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line"><span class="comment">#启用了rabbitmq的管理插件，会有一个web管理界面，默认监听端口15672，将此端口在防火墙上打开，则可以访问web界面</span></span><br></pre></td></tr></table></figure><h3 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h3><p>RabbitMQ利用erlang的分布式特性组建集群，erlang集群通过magic cookie实现，此cookie保存在$home/.erlang.cookie，这里即：/var/lib/rabbitmq/.erlang.cookie，需要保证集群各节点的此cookie一致，可以选取一个节点的cookie，采用scp同步到其余节点。</p><h4 id="同步cookie"><a href="#同步cookie" class="headerlink" title="同步cookie"></a>同步cookie</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意.erlang.cookie文件的权限，rabbitmq账号，权限400或600即可，为组或other账号赋权会报错</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># scp /var/lib/rabbitmq/.erlang.cookie root@172.16.3.232:/var/lib/rabbitmq/</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># scp /var/lib/rabbitmq/.erlang.cookie root@172.16.3.233:/var/lib/rabbitmq/</span></span><br></pre></td></tr></table></figure><h4 id="配置hosts"><a href="#配置hosts" class="headerlink" title="配置hosts"></a>配置hosts</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#组建集群时采用”cluster@node”的格式，需要提前设置hosts文件；</span></span><br><span class="line"><span class="comment">#rmq-node2/3配置相同</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># echo -e "172.16.3.231 rmq-node1\n172.16.3.232 rmq-node2\n172.16.3.233 rmq-node3" &gt;&gt; /etc/hosts</span></span><br></pre></td></tr></table></figure><h4 id="使用-detached参数启动节点"><a href="#使用-detached参数启动节点" class="headerlink" title="使用-detached参数启动节点"></a>使用-detached参数启动节点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rmq-node2/3因更换了.erlang.cookie，使用此命令会无效并报错，可以依次采用“systemctl stop rabbitmq-server”停止服务，“systemctl start rabbitmq-server”启动服务，最后再“rabbitmqctl stop”</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># rabbitmqctl stop</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># rabbitmq-server -detached</span></span><br></pre></td></tr></table></figure><h4 id="组建集群（rmq-node2-amp-rmq-node3）"><a href="#组建集群（rmq-node2-amp-rmq-node3）" class="headerlink" title="组建集群（rmq-node2&amp;rmq-node3）"></a>组建集群（rmq-node2&amp;rmq-node3）</h4><h5 id="组建集群（disk节点）"><a href="#组建集群（disk节点）" class="headerlink" title="组建集群（disk节点）"></a>组建集群（disk节点）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#“rabbitmqctl join_cluster rabbit@rmq-node1”中的“rabbit@rmq-node1”，rabbit代表集群名，rmq-node1代表集群节点（节点名同hostname，hostname与/etc/hosts中设置必须保持一致）；rmq-node2与rmq-node3均连接到rmq-node1，它们之间也会自动建立连接。</span></span><br><span class="line"><span class="comment">#如果需要使用内存节点，增加一个”--ram“的参数即可，如“rabbitmqctl join_cluster --ram rabbit@rmq-node1”，一个集群中至少需要一个”disk”节点 </span></span><br><span class="line">[root@rmq-node2 ~]<span class="comment"># rabbitmqctl stop_app</span></span><br><span class="line">[root@rmq-node2 ~]<span class="comment"># rabbitmqctl join_cluster rabbit@rmq-node1</span></span><br><span class="line">[root@rmq-node2 ~]<span class="comment"># rabbitmqctl start_app</span></span><br><span class="line"></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl stop_app</span></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl join_cluster rabbit@rmq-node1</span></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl start_app</span></span><br></pre></td></tr></table></figure><h5 id="修改disk节点到内存节点"><a href="#修改disk节点到内存节点" class="headerlink" title="修改disk节点到内存节点"></a>修改disk节点到内存节点</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果节点已是"disk"节点，可以修改为内存节点</span></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl stop_app</span></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl change_cluster_node_type ram</span></span><br><span class="line">[root@rmq-node3 ~]<span class="comment"># rabbitmqctl start_app</span></span><br></pre></td></tr></table></figure><h4 id="查看集群状态"><a href="#查看集群状态" class="headerlink" title="查看集群状态"></a>查看集群状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl cluster_status</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/feeloho/image_store/master/img/20200423150110.png" alt="集群状态"></p><ol><li>3个节点正常运行，其中rmq-node3是内存节点；</li><li>另外节点间的元数据也会同步，如前文只在rmq-node1节点创建的admin账号，此时也可在其他两个节点查询</li></ol><p>但节点间的配置文件不会同步，如前文在rmq-node1节点允许的guest账号远程登录，此时其他节点的guest账号并不具备登录权限。</p><h4 id="设置镜像队列高可用"><a href="#设置镜像队列高可用" class="headerlink" title="设置镜像队列高可用"></a>设置镜像队列高可用</h4><p>到目前为止，集群虽然搭建成功，但只是默认的普通集群，exchange，binding等数据可以复制到集群各节点。</p><p>但对于队列来说，各节点只有相同的元数据，即队列结构，但队列实体只存在于创建该队列的节点，即队列内容不会复制（从其余节点读取，可以建立临时的通信传输）。</p><p>这样此节点宕机后，其余节点无法从宕机节点获取还未消费的消息实体。如果做了持久化，则需要等待宕机节点恢复，期间其余节点不能创建宕机节点已创建过的持久化队列；如果未做持久化，则消息丢失。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#任意节点执行均可如下命令：将所有队列设置为镜像队列，即队列会被复制到各个节点，各个节点状态保持一直；</span></span><br><span class="line"><span class="comment">#可通过命令查看：rabbitmqctl list_policies；</span></span><br><span class="line"><span class="comment">#镜像队列相关解释与设置&amp;操作等请见：http://www.ywnds.com/?p=4741</span></span><br><span class="line">[root@rmq-node1 ~]<span class="comment"># rabbitmqctl set_policy ha-all "^" '&#123;"ha-mode":"all"&#125;'</span></span><br></pre></td></tr></table></figure><h3 id="Haproxy安装"><a href="#Haproxy安装" class="headerlink" title="Haproxy安装"></a>Haproxy安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install haproxy</span><br></pre></td></tr></table></figure><h4 id="Haproxy配置"><a href="#Haproxy配置" class="headerlink" title="Haproxy配置"></a>Haproxy配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绑定配置</span></span><br><span class="line">listen rabbitmq_management</span><br><span class="line">    <span class="comment">#配置TCP模式</span></span><br><span class="line">    mode http</span><br><span class="line">    <span class="comment">#加权轮询</span></span><br><span class="line">    balance roundrobin</span><br><span class="line">    <span class="comment">#访问端口</span></span><br><span class="line">    <span class="built_in">bind</span> 0.0.0.0:16672</span><br><span class="line">    <span class="comment">#RabbitMQ集群节点配置</span></span><br><span class="line">    server node1 x.x.x.x:15672 check inter 2000 rise 2 fall 3</span><br><span class="line">    server node1 x.x.x.x:15672 check inter 2000 rise 2 fall 3</span><br><span class="line"></span><br><span class="line">listen rabbitmq</span><br><span class="line">    <span class="comment">#配置TCP模式</span></span><br><span class="line">    mode tcp</span><br><span class="line">    <span class="comment">#加权轮询</span></span><br><span class="line">    balance roundrobin</span><br><span class="line">    <span class="comment">#访问端口</span></span><br><span class="line">    <span class="built_in">bind</span> 0.0.0.0:6672</span><br><span class="line">    <span class="comment">#RabbitMQ集群节点配置</span></span><br><span class="line">    server node1 x.x.x.x:5672 check inter 5s rise 2 fall 3</span><br><span class="line"></span><br><span class="line"><span class="comment">#haproxy监控页面地址</span></span><br><span class="line">listen admin_stats</span><br><span class="line">    <span class="built_in">bind</span> *:8100</span><br><span class="line">    mode http</span><br><span class="line">    option httplog</span><br><span class="line">    stats <span class="built_in">enable</span></span><br><span class="line">    stats refresh 5s</span><br><span class="line">    <span class="built_in">log</span> 127.0.0.1 local3 err</span><br><span class="line">    stats uri /</span><br><span class="line">    stats realm welcome login\ Haproxy</span><br><span class="line">    stats auth admin:admin</span><br><span class="line">    stats hide-version</span><br><span class="line">    stats admin <span class="keyword">if</span> TRUE</span><br></pre></td></tr></table></figure><h4 id="启动Haproxy"><a href="#启动Haproxy" class="headerlink" title="启动Haproxy"></a>启动Haproxy</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg</span><br></pre></td></tr></table></figure><p>关于RabbitMQ还想提几点，队列有。1.单机模式，2.普通模式集群，3.镜像队列，在普通模式上搭建起来的镜像队列可以同步queue和message，当主queue挂掉，从queue中会有一个变为主queue来接替工作，在 某台 rabbitmq节点上，执行 ： rabbitmqctl set_policy ha-all “^” ‘{“ha-mode”:“all”}’ 可以把队列设置为镜像队列</p><p><img src="https://raw.githubusercontent.com/feeloho/image_store/master/img/20200423150733.png" alt=""></p><h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ul><li><a href="https://blog.csdn.net/jason19905/article/details/102494041" target="_blank" rel="noopener">CentOS7安装RabbitMQ 3.8.0</a></li><li><a href="https://blog.csdn.net/zhuyu19911016520/article/details/80206202" target="_blank" rel="noopener">RabbitMQ + Haproxy 高可用队列集群</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;RabbitMQ是一个免费的开源企业消息代理软件。 它是用Erlang编写的，并实现了高级消息队列协议（AMQP）。 它提供所有主要编程语言的客户端库。 它支持多种消息传递协议，消息队列，传送确认，灵活的路由到队列，多种交换类型。 它还提供易于使用的HTTP-API，&lt;a href=&quot;https://www.linuxcool.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;命令&lt;/a&gt;行工具和用于管理RabbitMQ的Web UI；在本教程中，我们将在&lt;a href=&quot;https://www.linuxprobe.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CentOS&lt;/a&gt; 7服务器上安装RabbitMQ。&lt;/p&gt;
    
    </summary>
    
    
      <category term="RabbitMQ" scheme="https://www.qazhe.com/tags/RabbitMQ/"/>
    
      <category term="Proxy" scheme="https://www.qazhe.com/tags/Proxy/"/>
    
      <category term="Centos" scheme="https://www.qazhe.com/tags/Centos/"/>
    
  </entry>
  
  <entry>
    <title>openVPN安装及使用</title>
    <link href="https://www.qazhe.com/2020/04/08/openVPN%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.qazhe.com/2020/04/08/openVPN安装及使用/</id>
    <published>2020-04-08T14:20:30.160Z</published>
    <updated>2020-04-08T14:56:21.385Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.yeboyzq.com/tag/openvpn" target="_blank" rel="noopener">OpenVPN</a> 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。</p><p>OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。</p><a id="more"></a><h2 id="Server端环境"><a href="#Server端环境" class="headerlink" title="Server端环境"></a>Server端环境</h2><ul><li>Centos7</li><li><strong><a href="https://openvpn.net/" target="_blank" rel="noopener">OpenVPN</a> 版本：</strong>2.4.7</li><li><strong>easy-rsa 版本：</strong>3.0.3</li></ul><h3 id="yum安装OpenVPN"><a href="#yum安装OpenVPN" class="headerlink" title="yum安装OpenVPN"></a>yum安装OpenVPN</h3><h4 id="首先从yum安装OpenVPN及证书生成工具Easy-Rsa："><a href="#首先从yum安装OpenVPN及证书生成工具Easy-Rsa：" class="headerlink" title="首先从yum安装OpenVPN及证书生成工具Easy-Rsa："></a>首先从yum安装OpenVPN及证书生成工具Easy-Rsa：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openvpn easy-rsa</span><br></pre></td></tr></table></figure><h4 id="从示例配置文件复制一份配置文件到-etc-openvpn"><a href="#从示例配置文件复制一份配置文件到-etc-openvpn" class="headerlink" title="从示例配置文件复制一份配置文件到/etc/openvpn"></a>从示例配置文件复制一份配置文件到/etc/openvpn</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/doc/openvpn-*/sample/sample-config-files/server.conf /etc/openvpn/server.conf</span><br><span class="line">cp /usr/share/doc/openvpn-*/sample/sample-config-files/server.conf /etc/openvpn/server.conf_bak</span><br><span class="line">cp /usr/share/doc/openvpn-*/sample/sample-config-files/client.conf /etc/openvpn/client.conf_bak</span><br></pre></td></tr></table></figure><h3 id="使用easy-rsa生成证书及密钥"><a href="#使用easy-rsa生成证书及密钥" class="headerlink" title="使用easy-rsa生成证书及密钥"></a>使用easy-rsa生成证书及密钥</h3><p>完成了对于配置文件的修改之后，我们接下来生成keys和certificates。</p><p>yum安装完后有关的文件都在/usr/share/easy-rsa/2.0/ 这个目录中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/easy-rsa/2.0/</span><br></pre></td></tr></table></figure><ol><li>vars脚本, 是用来创建环境变量,设置所需要要的变量的脚本</li><li>clean-all脚本,是创建生成ca证书及密钥文件所需要的文件及目录</li><li>build-ca脚本, 生成ca证书(交互)</li><li>build-dh脚本, 生成Diffie-Hellman文件(交互)</li><li>build-key-server脚本, 生成服务器端密钥(交互)</li><li>build-key脚本, 生成客户端密钥(交互)</li><li>pkitool脚本,直接使用vars的环境变量设置,直接生成证书(非交互)</li></ol><h3 id="初始化PKI配置"><a href="#初始化PKI配置" class="headerlink" title="初始化PKI配置"></a>初始化PKI配置</h3><h4 id="首先需要修改的是vars文件"><a href="#首先需要修改的是vars文件" class="headerlink" title="首先需要修改的是vars文件"></a>首先需要修改的是vars文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim vars</span><br></pre></td></tr></table></figure><h4 id="将以下这些值修改成你自己的值"><a href="#将以下这些值修改成你自己的值" class="headerlink" title="将以下这些值修改成你自己的值"></a>将以下这些值修改成你自己的值</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KEY_SIZE=2048    //生成密钥的位数</span><br><span class="line"><span class="built_in">export</span> KEY_COUNTRY=<span class="string">"CN"</span>    //你所在国家码，2个字符</span><br><span class="line"><span class="built_in">export</span> KEY_PROVINCE=<span class="string">"GD"</span>    //你所在省份</span><br><span class="line"><span class="built_in">export</span> KEY_CITY=<span class="string">"SHENZHEN"</span>    //你所在城市</span><br><span class="line"><span class="built_in">export</span> KEY_ORG=<span class="string">"CESHI"</span>    //你所在组织</span><br><span class="line"><span class="built_in">export</span> KEY_EMAIL=<span class="string">"admin@ceshi.com"</span>    //你的邮箱地址</span><br><span class="line"><span class="built_in">export</span> KEY_CN=ceshi    //随意</span><br><span class="line"><span class="built_in">export</span> KEY_NAME=ceshi    //随意</span><br><span class="line"><span class="built_in">export</span> KEY_OU=CESHI    //你所在的单位</span><br></pre></td></tr></table></figure><h4 id="修改完成之后，执行-source-vars-清空目录并生成-Certificate-Authority-CA"><a href="#修改完成之后，执行-source-vars-清空目录并生成-Certificate-Authority-CA" class="headerlink" title="修改完成之后，执行 source ./vars, 清空目录并生成 Certificate Authority(CA):"></a>修改完成之后，执行 source ./vars, 清空目录并生成 Certificate Authority(CA):</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ./vars</span><br></pre></td></tr></table></figure><h4 id="创建生成ca证书及密钥文件所需要的文件及目录并创建证书"><a href="#创建生成ca证书及密钥文件所需要的文件及目录并创建证书" class="headerlink" title="创建生成ca证书及密钥文件所需要的文件及目录并创建证书"></a>创建生成ca证书及密钥文件所需要的文件及目录并创建证书</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./clean-all</span><br><span class="line">./build-ca</span><br></pre></td></tr></table></figure><p>执行完成之后在/usr/share/easy-rsa/2.0/keys目录中产生了CA正式的相关文件。</p><h4 id="接下来为服务器生成证书及密钥"><a href="#接下来为服务器生成证书及密钥" class="headerlink" title="接下来为服务器生成证书及密钥"></a>接下来为服务器生成证书及密钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build-key-server server</span><br></pre></td></tr></table></figure><h4 id="再生成Diffie-Hellman-key-exchange文件，这里生成的长度由之前的KEY-SIZE决定："><a href="#再生成Diffie-Hellman-key-exchange文件，这里生成的长度由之前的KEY-SIZE决定：" class="headerlink" title="再生成Diffie Hellman key exchange文件，这里生成的长度由之前的KEY_SIZE决定："></a>再生成Diffie Hellman key exchange文件，这里生成的长度由之前的KEY_SIZE决定：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build-dh</span><br></pre></td></tr></table></figure><p>执行完成会产生dh2048.pem (如果你的KEY_SIZE =1024，这里产生的文件是dh1024.pem)</p><h4 id="生成TLS-auth密钥，OpenVPN提供了TLS-auth功能，可以用来抵御Dos、UDP端口淹没攻击。"><a href="#生成TLS-auth密钥，OpenVPN提供了TLS-auth功能，可以用来抵御Dos、UDP端口淹没攻击。" class="headerlink" title="生成TLS-auth密钥，OpenVPN提供了TLS-auth功能，可以用来抵御Dos、UDP端口淹没攻击。"></a>生成TLS-auth密钥，OpenVPN提供了TLS-auth功能，可以用来抵御Dos、UDP端口淹没攻击。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openvpn --genkey --secret keys/ta.key</span><br></pre></td></tr></table></figure><h4 id="生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN"><a href="#生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN" class="headerlink" title="生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN"></a>生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make-crl vpncrl.pem</span><br></pre></td></tr></table></figure><h4 id="生成客户端证书及密钥"><a href="#生成客户端证书及密钥" class="headerlink" title="生成客户端证书及密钥"></a>生成客户端证书及密钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build-key client</span><br></pre></td></tr></table></figure><h4 id="生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN-1"><a href="#生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN-1" class="headerlink" title="生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN"></a>生成证书吊销链文件防止日后有人丢失证书被非法用户接入VPN</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./make-crl vpncrl.pem</span><br><span class="line">Using configuration from /etc/openvpn/openssl.cnf</span><br></pre></td></tr></table></figure><h4 id="将7个所需文件复制到OpenVPN配置目录中去："><a href="#将7个所需文件复制到OpenVPN配置目录中去：" class="headerlink" title="将7个所需文件复制到OpenVPN配置目录中去："></a>将7个所需文件复制到OpenVPN配置目录中去：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/openvpn/keys/</span><br><span class="line">cp  ca.crt server.crt server.key dh2048.pem ta.key client.crt client.key vpncrl.pem /etc/openvpn/keys</span><br></pre></td></tr></table></figure><h3 id="配置OpenVPN"><a href="#配置OpenVPN" class="headerlink" title="配置OpenVPN"></a>配置OpenVPN</h3><p>打开 /etc/openvpn/server.conf 编辑：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/openvpn/server.conf</span><br></pre></td></tr></table></figure><p>根据需求调整相应的配置项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># Sample OpenVPN 2.0 config file for #</span></span><br><span class="line"><span class="comment"># multi-client server. #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># This file is for the server side #</span></span><br><span class="line"><span class="comment"># of a many-clients &lt;-&gt; one-server #</span></span><br><span class="line"><span class="comment"># OpenVPN configuration. #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># OpenVPN also supports #</span></span><br><span class="line"><span class="comment"># single-machine &lt;-&gt; single-machine #</span></span><br><span class="line"><span class="comment"># configurations (See the Examples page #</span></span><br><span class="line"><span class="comment"># on the web site for more info). #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># This config should work on Windows #</span></span><br><span class="line"><span class="comment"># or Linux/BSD systems. Remember on #</span></span><br><span class="line"><span class="comment"># Windows to quote pathnames and use #</span></span><br><span class="line"><span class="comment"># double backslashes, e.g.: #</span></span><br><span class="line"><span class="comment"># "C:\\Program Files\\OpenVPN\\config\\foo.key" #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># Comments are preceded with '#' or ';' #</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Which local IP address should OpenVPN</span></span><br><span class="line"><span class="comment"># listen on? (optional)</span></span><br><span class="line">;<span class="built_in">local</span> a.b.c.d    //设置服务器监听地址，默认全部</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Which TCP/UDP port should OpenVPN listen on?</span></span><br><span class="line"><span class="comment"># If you want to run multiple OpenVPN instances</span></span><br><span class="line"><span class="comment"># on the same machine, use a different port</span></span><br><span class="line"><span class="comment"># number for each one. You will need to</span></span><br><span class="line"><span class="comment"># open up this port on your firewall.</span></span><br><span class="line">port 1194     //设置服务器监听端口，默认1194</span><br><span class="line"> </span><br><span class="line"><span class="comment"># TCP or UDP server?</span></span><br><span class="line">;proto tcp    //设置连接协议，TCP/UDP二选一</span><br><span class="line">proto udp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># "dev tun" will create a routed IP tunnel,</span></span><br><span class="line"><span class="comment"># "dev tap" will create an ethernet tunnel.</span></span><br><span class="line"><span class="comment"># Use "dev tap0" if you are ethernet bridging</span></span><br><span class="line"><span class="comment"># and have precreated a tap0 virtual interface</span></span><br><span class="line"><span class="comment"># and bridged it with your ethernet interface.</span></span><br><span class="line"><span class="comment"># If you want to control access policies</span></span><br><span class="line"><span class="comment"># over the VPN, you must create firewall</span></span><br><span class="line"><span class="comment"># rules for the the TUN/TAP interface.</span></span><br><span class="line"><span class="comment"># On non-Windows systems, you can give</span></span><br><span class="line"><span class="comment"># an explicit unit number, such as tun0.</span></span><br><span class="line"><span class="comment"># On Windows, use "dev-node" for this.</span></span><br><span class="line"><span class="comment"># On most systems, the VPN will not function</span></span><br><span class="line"><span class="comment"># unless you partially or fully disable</span></span><br><span class="line"><span class="comment"># the firewall for the TUN/TAP interface.</span></span><br><span class="line">;dev tap    //创建的通信隧道类型，可选tun或tap</span><br><span class="line">dev tun</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Windows needs the TAP-Win32 adapter name</span></span><br><span class="line"><span class="comment"># from the Network Connections panel if you</span></span><br><span class="line"><span class="comment"># have more than one. On XP SP2 or higher,</span></span><br><span class="line"><span class="comment"># you may need to selectively disable the</span></span><br><span class="line"><span class="comment"># Windows firewall for the TAP adapter.</span></span><br><span class="line"><span class="comment"># Non-Windows systems usually don't need this.</span></span><br><span class="line">;dev-node MyTap    //Windows下TAP适配器名称，默认可不启用</span><br><span class="line"> </span><br><span class="line"><span class="comment"># SSL/TLS root certificate (ca), certificate</span></span><br><span class="line"><span class="comment"># (cert), and private key (key). Each client</span></span><br><span class="line"><span class="comment"># and the server must have their own cert and</span></span><br><span class="line"><span class="comment"># key file. The server and all clients will</span></span><br><span class="line"><span class="comment"># use the same ca file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See the "easy-rsa" directory for a series</span></span><br><span class="line"><span class="comment"># of scripts for generating RSA certificates</span></span><br><span class="line"><span class="comment"># and private keys. Remember to use</span></span><br><span class="line"><span class="comment"># a unique Common Name for the server</span></span><br><span class="line"><span class="comment"># and each of the client certificates.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Any X509 key management system can be used.</span></span><br><span class="line"><span class="comment"># OpenVPN can also use a PKCS #12 formatted key file</span></span><br><span class="line"><span class="comment"># (see "pkcs12" directive in man page).</span></span><br><span class="line">ca ca.crt    //指定CA证书的文件路径</span><br><span class="line">cert server.crt    //指定服务器端的证书文件路径</span><br><span class="line">key server.key <span class="comment"># This file should be kept secret    //指定服务器端的私钥文件路径</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Diffie hellman parameters.</span></span><br><span class="line"><span class="comment"># Generate your own with:</span></span><br><span class="line"><span class="comment"># openssl dhparam -out dh2048.pem 2048</span></span><br><span class="line">dh dh2048.pem    //指定迪菲赫尔曼参数的文件路径</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Network topology</span></span><br><span class="line"><span class="comment"># Should be subnet (addressing via IP)</span></span><br><span class="line"><span class="comment"># unless Windows clients v2.0.9 and lower have to</span></span><br><span class="line"><span class="comment"># be supported (then net30, i.e. a /30 per client)</span></span><br><span class="line"><span class="comment"># Defaults to net30 (not recommended)</span></span><br><span class="line">;topology subnet</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Configure server mode and supply a VPN subnet</span></span><br><span class="line"><span class="comment"># for OpenVPN to draw client addresses from.</span></span><br><span class="line"><span class="comment"># The server will take 10.8.0.1 for itself,</span></span><br><span class="line"><span class="comment"># the rest will be made available to clients.</span></span><br><span class="line"><span class="comment"># Each client will be able to reach the server</span></span><br><span class="line"><span class="comment"># on 10.8.0.1. Comment this line out if you are</span></span><br><span class="line"><span class="comment"># ethernet bridging. See the man page for more info.</span></span><br><span class="line">server 10.8.0.0 255.255.255.0    //指定虚拟局域网占用的IP地址段和子网掩码，此处配置的服务器自身占用10.0.0.1。</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Maintain a record of client &lt;-&gt; virtual IP address</span></span><br><span class="line"><span class="comment"># associations in this file. If OpenVPN goes down or</span></span><br><span class="line"><span class="comment"># is restarted, reconnecting clients can be assigned</span></span><br><span class="line"><span class="comment"># the same virtual IP address from the pool that was</span></span><br><span class="line"><span class="comment"># previously assigned.</span></span><br><span class="line">ifconfig-pool-persist ipp.txt    //服务器自动给客户端分配IP后，客户端下次连接时，仍然采用上次的IP地址(第一次分配的IP保存在ipp.txt中，下一次分配其中保存的IP)。</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Configure server mode for ethernet bridging.</span></span><br><span class="line"><span class="comment"># You must first use your OS's bridging capability</span></span><br><span class="line"><span class="comment"># to bridge the TAP interface with the ethernet</span></span><br><span class="line"><span class="comment"># NIC interface. Then you must manually set the</span></span><br><span class="line"><span class="comment"># IP/netmask on the bridge interface, here we</span></span><br><span class="line"><span class="comment"># assume 10.8.0.4/255.255.255.0. Finally we</span></span><br><span class="line"><span class="comment"># must set aside an IP range in this subnet</span></span><br><span class="line"><span class="comment"># (start=10.8.0.50 end=10.8.0.100) to allocate</span></span><br><span class="line"><span class="comment"># to connecting clients. Leave this line commented</span></span><br><span class="line"><span class="comment"># out unless you are ethernet bridging.</span></span><br><span class="line">;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100    //设置桥接模式下的IP地址</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Configure server mode for ethernet bridging</span></span><br><span class="line"><span class="comment"># using a DHCP-proxy, where clients talk</span></span><br><span class="line"><span class="comment"># to the OpenVPN server-side DHCP server</span></span><br><span class="line"><span class="comment"># to receive their IP address allocation</span></span><br><span class="line"><span class="comment"># and DNS server addresses. You must first use</span></span><br><span class="line"><span class="comment"># your OS's bridging capability to bridge the TAP</span></span><br><span class="line"><span class="comment"># interface with the ethernet NIC interface.</span></span><br><span class="line"><span class="comment"># Note: this mode only works on clients (such as</span></span><br><span class="line"><span class="comment"># Windows), where the client-side TAP adapter is</span></span><br><span class="line"><span class="comment"># bound to a DHCP client.</span></span><br><span class="line">;server-bridge    //设置服务器模式</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Push routes to the client to allow it</span></span><br><span class="line"><span class="comment"># to reach other private subnets behind</span></span><br><span class="line"><span class="comment"># the server. Remember that these</span></span><br><span class="line"><span class="comment"># private subnets will also need</span></span><br><span class="line"><span class="comment"># to know to route the OpenVPN client</span></span><br><span class="line"><span class="comment"># address pool (10.8.0.0/255.255.255.0)</span></span><br><span class="line"><span class="comment"># back to the OpenVPN server.</span></span><br><span class="line">;push <span class="string">"route 192.168.10.0 255.255.255.0"</span>    //设置需要推送到客户端的路由表</span><br><span class="line">;push <span class="string">"route 192.168.20.0 255.255.255.0"</span></span><br><span class="line">;push “route remote_host 255.255.255.255 net_gateway”    //设置VPN服务器本身要通过客户端原来的网关访问(取消redirect-gateway def1 bypass-dhcp选项后这项必须开启，否则无法访问OpenVPN服务器)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># To assign specific IP addresses to specific</span></span><br><span class="line"><span class="comment"># clients or if a connecting client has a private</span></span><br><span class="line"><span class="comment"># subnet behind it that should also have VPN access,</span></span><br><span class="line"><span class="comment"># use the subdirectory "ccd" for client-specific</span></span><br><span class="line"><span class="comment"># configuration files (see man page for more info).</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># EXAMPLE: Suppose the client</span></span><br><span class="line"><span class="comment"># having the certificate common name "Thelonious"</span></span><br><span class="line"><span class="comment"># also has a small subnet behind his connecting</span></span><br><span class="line"><span class="comment"># machine, such as 192.168.40.128/255.255.255.248.</span></span><br><span class="line"><span class="comment"># First, uncomment out these lines:</span></span><br><span class="line">;client-config-dir ccd</span><br><span class="line">;route 192.168.40.128 255.255.255.248</span><br><span class="line"><span class="comment"># Then create a file ccd/Thelonious with this line:</span></span><br><span class="line"><span class="comment"># iroute 192.168.40.128 255.255.255.248</span></span><br><span class="line"><span class="comment"># This will allow Thelonious' private subnet to</span></span><br><span class="line"><span class="comment"># access the VPN. This example will only work</span></span><br><span class="line"><span class="comment"># if you are routing, not bridging, i.e. you are</span></span><br><span class="line"><span class="comment"># using "dev tun" and "server" directives.</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># EXAMPLE: Suppose you want to give</span></span><br><span class="line"><span class="comment"># Thelonious a fixed VPN IP address of 10.9.0.1.</span></span><br><span class="line"><span class="comment"># First uncomment out these lines:</span></span><br><span class="line">;client-config-dir ccd</span><br><span class="line">;route 10.9.0.0 255.255.255.252</span><br><span class="line"><span class="comment"># Then add this line to ccd/Thelonious:</span></span><br><span class="line"><span class="comment"># ifconfig-push 10.9.0.1 10.9.0.2</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Suppose that you want to enable different</span></span><br><span class="line"><span class="comment"># firewall access policies for different groups</span></span><br><span class="line"><span class="comment"># of clients. There are two methods:</span></span><br><span class="line"><span class="comment"># (1) Run multiple OpenVPN daemons, one for each</span></span><br><span class="line"><span class="comment"># group, and firewall the TUN/TAP interface</span></span><br><span class="line"><span class="comment"># for each group/daemon appropriately.</span></span><br><span class="line"><span class="comment"># (2) (Advanced) Create a script to dynamically</span></span><br><span class="line"><span class="comment"># modify the firewall in response to access</span></span><br><span class="line"><span class="comment"># from different clients. See man</span></span><br><span class="line"><span class="comment"># page for more info on learn-address script.</span></span><br><span class="line">;learn-address ./script</span><br><span class="line"> </span><br><span class="line"><span class="comment"># If enabled, this directive will configure</span></span><br><span class="line"><span class="comment"># all clients to redirect their default</span></span><br><span class="line"><span class="comment"># network gateway through the VPN, causing</span></span><br><span class="line"><span class="comment"># all IP traffic such as web browsing and</span></span><br><span class="line"><span class="comment"># and DNS lookups to go through the VPN</span></span><br><span class="line"><span class="comment"># (The OpenVPN server machine may need to NAT</span></span><br><span class="line"><span class="comment"># or bridge the TUN/TAP interface to the internet</span></span><br><span class="line"><span class="comment"># in order for this to work properly).</span></span><br><span class="line">;push <span class="string">"redirect-gateway def1 bypass-dhcp"</span>    //设置默认客户端默认网关</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Certain Windows-specific network settings</span></span><br><span class="line"><span class="comment"># can be pushed to clients, such as DNS</span></span><br><span class="line"><span class="comment"># or WINS server addresses. CAVEAT:</span></span><br><span class="line"><span class="comment"># http://openvpn.net/faq.html#dhcpcaveats</span></span><br><span class="line"><span class="comment"># The addresses below refer to the public</span></span><br><span class="line"><span class="comment"># DNS servers provided by opendns.com.</span></span><br><span class="line">;push <span class="string">"dhcp-option DNS 208.67.222.222"</span>    //设置客户端DNS</span><br><span class="line">;push <span class="string">"dhcp-option DNS 208.67.220.220"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Uncomment this directive to allow different</span></span><br><span class="line"><span class="comment"># clients to be able to "see" each other.</span></span><br><span class="line"><span class="comment"># By default, clients will only see the server.</span></span><br><span class="line"><span class="comment"># To force clients to only see the server, you</span></span><br><span class="line"><span class="comment"># will also need to appropriately firewall the</span></span><br><span class="line"><span class="comment"># server's TUN/TAP interface.</span></span><br><span class="line">;client-to-client     //设置客户端是否可以访问客户端</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Uncomment this directive if multiple clients</span></span><br><span class="line"><span class="comment"># might connect with the same certificate/key</span></span><br><span class="line"><span class="comment"># files or common names. This is recommended</span></span><br><span class="line"><span class="comment"># only for testing purposes. For production use,</span></span><br><span class="line"><span class="comment"># each client should have its own certificate/key</span></span><br><span class="line"><span class="comment"># pair.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># IF YOU HAVE NOT GENERATED INDIVIDUAL</span></span><br><span class="line"><span class="comment"># CERTIFICATE/KEY PAIRS FOR EACH CLIENT,</span></span><br><span class="line"><span class="comment"># EACH HAVING ITS OWN UNIQUE "COMMON NAME",</span></span><br><span class="line"><span class="comment"># UNCOMMENT THIS LINE OUT.</span></span><br><span class="line">;duplicate-cn    //如果客户端都使用相同的证书和密钥连接VPN，一定要打开这个选项，否则每个证书只允许一个人连接VPN</span><br><span class="line"> </span><br><span class="line"><span class="comment"># The keepalive directive causes ping-like</span></span><br><span class="line"><span class="comment"># messages to be sent back and forth over</span></span><br><span class="line"><span class="comment"># the link so that each side knows when</span></span><br><span class="line"><span class="comment"># the other side has gone down.</span></span><br><span class="line"><span class="comment"># Ping every 10 seconds, assume that remote</span></span><br><span class="line"><span class="comment"># peer is down if no ping received during</span></span><br><span class="line"><span class="comment"># a 120 second time period.</span></span><br><span class="line">keepalive 10 120    //每10秒ping一次，连接超时时间设为120秒。</span><br><span class="line"> </span><br><span class="line"><span class="comment"># For extra security beyond that provided</span></span><br><span class="line"><span class="comment"># by SSL/TLS, create an "HMAC firewall"</span></span><br><span class="line"><span class="comment"># to help block DoS attacks and UDP port flooding.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Generate with:</span></span><br><span class="line"><span class="comment"># openvpn --genkey --secret ta.key</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The server and each client must have</span></span><br><span class="line"><span class="comment"># a copy of this key.</span></span><br><span class="line"><span class="comment"># The second parameter should be '0'</span></span><br><span class="line"><span class="comment"># on the server and '1' on the clients.</span></span><br><span class="line">tls-auth ta.key 0 <span class="comment"># This file is secret    //开启TLS-auth，使用ta.key防御攻击。服务器端的第二个参数值为0，客户端的为1。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># This config item must be copied to</span></span><br><span class="line"><span class="comment"># the client config file as well.</span></span><br><span class="line"><span class="comment"># Note that 2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-CBC    //指定数据对称加密算法</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Enable compression on the VPN link and push the</span></span><br><span class="line"><span class="comment"># option to the client (2.4+ only, for earlier</span></span><br><span class="line"><span class="comment"># versions see below)</span></span><br><span class="line">;compress lz4-v2</span><br><span class="line">;push <span class="string">"compress lz4-v2"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># For compression compatible with older clients use comp-lzo</span></span><br><span class="line"><span class="comment"># If you enable it here, you must also</span></span><br><span class="line"><span class="comment"># enable it in the client config file.</span></span><br><span class="line">;comp-lzo    //开启VPN连接压缩，如果服务器端开启，客户端也必须开启</span><br><span class="line"> </span><br><span class="line"><span class="comment"># The maximum number of concurrently connected</span></span><br><span class="line"><span class="comment"># clients we want to allow.</span></span><br><span class="line">;max-clients 100</span><br><span class="line"> </span><br><span class="line"><span class="comment"># It's a good idea to reduce the OpenVPN</span></span><br><span class="line"><span class="comment"># daemon's privileges after initialization.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can uncomment this out on</span></span><br><span class="line"><span class="comment"># non-Windows systems.</span></span><br><span class="line">;user nobody    //设置运行账户及组</span><br><span class="line">;group nobody</span><br><span class="line"> </span><br><span class="line"><span class="comment"># The persist options will try to avoid</span></span><br><span class="line"><span class="comment"># accessing certain resources on restart</span></span><br><span class="line"><span class="comment"># that may no longer be accessible because</span></span><br><span class="line"><span class="comment"># of the privilege downgrade.</span></span><br><span class="line">persist-key    //持久化选项可以尽量避免访问在重启时由于用户权限降低而无法访问的某些资源。</span><br><span class="line">persist-tun</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Output a short status file showing</span></span><br><span class="line"><span class="comment"># current connections, truncated</span></span><br><span class="line"><span class="comment"># and rewritten every minute.</span></span><br><span class="line">status openvpn-status.log    //设置启动日志</span><br><span class="line"> </span><br><span class="line"><span class="comment"># By default, log messages will go to the syslog (or</span></span><br><span class="line"><span class="comment"># on Windows, if running as a service, they will go to</span></span><br><span class="line"><span class="comment"># the "\Program Files\OpenVPN\log" directory).</span></span><br><span class="line"><span class="comment"># Use log or log-append to override this default.</span></span><br><span class="line"><span class="comment"># "log" will truncate the log file on OpenVPN startup,</span></span><br><span class="line"><span class="comment"># while "log-append" will append to it. Use one</span></span><br><span class="line"><span class="comment"># or the other (but not both).</span></span><br><span class="line">;<span class="built_in">log</span> openvpn.log    //设置运行日志</span><br><span class="line">;<span class="built_in">log</span>-append openvpn.log</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Set the appropriate level of log</span></span><br><span class="line"><span class="comment"># file verbosity.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 0 is silent, except for fatal errors</span></span><br><span class="line"><span class="comment"># 4 is reasonable for general usage</span></span><br><span class="line"><span class="comment"># 5 and 6 can help to debug connection problems</span></span><br><span class="line"><span class="comment"># 9 is extremely verbose</span></span><br><span class="line">verb 3    //设置日志记录级别（0-9）</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Silence repeating messages. At most 20</span></span><br><span class="line"><span class="comment"># sequential messages of the same message</span></span><br><span class="line"><span class="comment"># category will be output to the log.</span></span><br><span class="line">;mute 20    //设置重复消息</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Notify the client that when the server restarts so it</span></span><br><span class="line"><span class="comment"># can automatically reconnect.</span></span><br><span class="line">explicit-exit-notify 1    //设置断线重连功能</span><br><span class="line"> </span><br><span class="line">crl-verify /etc/openvpn/keys/vpncrl.pem //用于注销已删除用户的key</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用Linux系统账户登录VPN</span></span><br><span class="line">;plugin /usr/lib64/openvpn/plugins/openvpn-plugin-auth-pam.so login <span class="comment"># login为指定使用linux本身认证</span></span><br><span class="line">;client-cert-not-required <span class="comment">#取消证书认证</span></span><br><span class="line">;username-as-common-name <span class="comment">#使用客户提供的UserName作为Common Name</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用脚本验证用户名密码登录VPN</span></span><br><span class="line">;script-security 3 <span class="comment">#OpenVPN使用外部程序和脚本的策略级控制</span></span><br><span class="line">;auth-user-pass-verify /usr/<span class="built_in">local</span>/openvpn/etc/checkpsw.sh via-env  <span class="comment">#设置脚本</span></span><br><span class="line">;client-cert-not-required <span class="comment">#取消证书认证</span></span><br><span class="line">;username-as-common-name <span class="comment">#使用客户提供的UserName作为Common Name</span></span><br></pre></td></tr></table></figure><p>附checkpsw.sh脚本代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh </span></span><br><span class="line"><span class="comment">########################################################### </span></span><br><span class="line"><span class="comment"># checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt; </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># This script will authenticate OpenVPN users against </span></span><br><span class="line"><span class="comment"># a plain text file. The passfile should simply contain </span></span><br><span class="line"><span class="comment"># one row per user with the username first followed by </span></span><br><span class="line"><span class="comment"># one or more space(s) or tab(s) and then the password. </span></span><br><span class="line"> </span><br><span class="line">PASSFILE=<span class="string">"/etc/openvpn/psw-file"</span> </span><br><span class="line">LOG_FILE=<span class="string">"/var/log/openvpn-password.log"</span> </span><br><span class="line">TIME_STAMP=`date <span class="string">"+%Y-%m-%d %T"</span>` </span><br><span class="line"> </span><br><span class="line"><span class="comment">########################################################### </span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ ! -r <span class="string">"<span class="variable">$&#123;PASSFILE&#125;</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Could not open password file \"<span class="variable">$&#123;PASSFILE&#125;</span>\" for reading."</span> &gt;&gt; </span><br><span class="line"> </span><br><span class="line"><span class="variable">$&#123;LOG_FILE&#125;</span> </span><br><span class="line"> <span class="built_in">exit</span> 1 </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"> </span><br><span class="line">CORRECT_PASSWORD=`awk <span class="string">'!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'</span><span class="variable">$&#123;username&#125;</span><span class="string">'"&#123;print $2;exit&#125;'</span> <span class="variable">$&#123;PASSFILE&#125;</span>` </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> = <span class="string">""</span> ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: User does not exist: username=\"<span class="variable">$&#123;username&#125;</span>\", password= </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span> </span><br><span class="line"> <span class="built_in">exit</span> 1 </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;password&#125;</span>"</span> = <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Successful authentication: username=\"<span class="variable">$&#123;username&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span> </span><br><span class="line"> <span class="built_in">exit</span> 0 </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Incorrect password: username=\"<span class="variable">$&#123;username&#125;</span>\", password= </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span> </span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure><p>准备用户名和密码认证文件，用户名和密码用空格隔开，同时确保openvpn启动用户可读取该文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim psw-file</span><br><span class="line">vpnuser 123456 </span><br><span class="line">chmod 775 psw-file </span><br><span class="line">chown nobody.nobody psw-file</span><br></pre></td></tr></table></figure><h3 id="调整系统设置并启动OpenVPN-Server"><a href="#调整系统设置并启动OpenVPN-Server" class="headerlink" title="调整系统设置并启动OpenVPN Server"></a>调整系统设置并启动OpenVPN Server</h3><h4 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h4><p>在CentOS 7中，iptables防火墙已经被firewalld所取代，需要使用如下方法：</p><p>首先启动firewalld</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure><p>查看有哪些服务已经在列表中允许通过：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-services</span><br><span class="line">dhcpv6-client http https ssh</span><br></pre></td></tr></table></figure><p>可以看到已经有了dhcpv6-client, http, https, ssh四项，接下来添加openvpn：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=pupublic --add-service openvpn</span><br><span class="line">success</span><br></pre></td></tr></table></figure><p>检查一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-services</span><br><span class="line">dhcpv6-client http https openvpn ssh</span><br></pre></td></tr></table></figure><p>最后添加masquerade:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-masquerade</span><br><span class="line">success</span><br><span class="line">firewall-cmd --permanent --add-masquerade</span><br><span class="line">success</span><br></pre></td></tr></table></figure><p>以下命令用于确认masquerade是否添加成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --query-masquerade</span><br><span class="line">yes</span><br></pre></td></tr></table></figure><h4 id="允许IP转发"><a href="#允许IP转发" class="headerlink" title="允许IP转发"></a>允许IP转发</h4><p>在sysctl中开启IP转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Controls IP packet forwarding</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure><h4 id="启动OpenVPN服务"><a href="#启动OpenVPN服务" class="headerlink" title="启动OpenVPN服务"></a>启动OpenVPN服务</h4><p>启动OpenVPN服务器并添加自动启动项</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start openvpn@server.service</span><br><span class="line">systemctl <span class="built_in">enable</span> openvpn@server.service</span><br></pre></td></tr></table></figure><p>至此服务端搭建完成。</p><h2 id="OpenVPN客户端配置"><a href="#OpenVPN客户端配置" class="headerlink" title="OpenVPN客户端配置"></a>OpenVPN客户端配置</h2><h3 id="客户端配置文件"><a href="#客户端配置文件" class="headerlink" title="客户端配置文件"></a>客户端配置文件</h3><p>取回之前生成的位于/etc/openvpn/keys中的4个文件：</p><p>ca.crt client.crt client.key ta.key</p><p>在你的客户端创建文件client.ovpn, 将这4个文件与其放在同一目录中，配置client.ovpn内容如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##############################################</span></span><br><span class="line"><span class="comment"># Sample client-side OpenVPN 2.0 config file #</span></span><br><span class="line"><span class="comment"># for connecting to multi-client server. #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># This configuration can be used by multiple #</span></span><br><span class="line"><span class="comment"># clients, however each client should have #</span></span><br><span class="line"><span class="comment"># its own cert and key files. #</span></span><br><span class="line"><span class="comment"># #</span></span><br><span class="line"><span class="comment"># On Windows, you might want to rename this #</span></span><br><span class="line"><span class="comment"># file so it has a .ovpn extension #</span></span><br><span class="line"><span class="comment">##############################################</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Specify that we are a client and that we</span></span><br><span class="line"><span class="comment"># will be pulling certain config file directives</span></span><br><span class="line"><span class="comment"># from the server.</span></span><br><span class="line">client    //指定当前VPN是客户端</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Use the same setting as you are using on</span></span><br><span class="line"><span class="comment"># the server.</span></span><br><span class="line"><span class="comment"># On most systems, the VPN will not function</span></span><br><span class="line"><span class="comment"># unless you partially or fully disable</span></span><br><span class="line"><span class="comment"># the firewall for the TUN/TAP interface.</span></span><br><span class="line">;dev tap    //与服务器端的保持一致</span><br><span class="line">dev tun</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Windows needs the TAP-Win32 adapter name</span></span><br><span class="line"><span class="comment"># from the Network Connections panel</span></span><br><span class="line"><span class="comment"># if you have more than one. On XP SP2,</span></span><br><span class="line"><span class="comment"># you may need to disable the firewall</span></span><br><span class="line"><span class="comment"># for the TAP adapter.</span></span><br><span class="line">;dev-node MyTap  //Windows下TAP适配器名称，默认可不启用</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Are we connecting to a TCP or</span></span><br><span class="line"><span class="comment"># UDP server? Use the same setting as</span></span><br><span class="line"><span class="comment"># on the server.</span></span><br><span class="line">;proto tcp    //与服务器端的保持一致</span><br><span class="line">proto udp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># The hostname/IP and port of the server.</span></span><br><span class="line"><span class="comment"># You can have multiple remote entries</span></span><br><span class="line"><span class="comment"># to load balance between the servers.</span></span><br><span class="line">remote my-server-1 1194    //指定连接的远程服务器的地址和端口号，端口号与服务器端的保持一致</span><br><span class="line">;remote my-server-2 1194</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Choose a random host from the remote</span></span><br><span class="line"><span class="comment"># list for load-balancing. Otherwise</span></span><br><span class="line"><span class="comment"># try hosts in the order specified.</span></span><br><span class="line">;remote-random</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Keep trying indefinitely to resolve the</span></span><br><span class="line"><span class="comment"># host name of the OpenVPN server. Very useful</span></span><br><span class="line"><span class="comment"># on machines which are not permanently connected</span></span><br><span class="line"><span class="comment"># to the internet such as laptops.</span></span><br><span class="line">resolv-retry infinite    //断线自动重新连接</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Most clients don't need to bind to</span></span><br><span class="line"><span class="comment"># a specific local port number.</span></span><br><span class="line">nobind    //不绑定特定的本地端口号</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Downgrade privileges after initialization (non-Windows only)</span></span><br><span class="line">;user nobody</span><br><span class="line">;group nobody</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Try to preserve some state across restarts.</span></span><br><span class="line">persist-key    //与服务器端的保持一致</span><br><span class="line">persist-tun    //与服务器端的保持一致</span><br><span class="line"> </span><br><span class="line"><span class="comment"># If you are connecting through an</span></span><br><span class="line"><span class="comment"># HTTP proxy to reach the actual OpenVPN</span></span><br><span class="line"><span class="comment"># server, put the proxy server/IP and</span></span><br><span class="line"><span class="comment"># port number here. See the man page</span></span><br><span class="line"><span class="comment"># if your proxy server requires</span></span><br><span class="line"><span class="comment"># authentication.</span></span><br><span class="line">;http-proxy-retry <span class="comment"># retry on connection failures    //指定HTTP代理</span></span><br><span class="line">;http-proxy [proxy server] [proxy port <span class="comment">#] </span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Wireless networks often produce a lot</span></span><br><span class="line"><span class="comment"># of duplicate packets. Set this flag</span></span><br><span class="line"><span class="comment"># to silence duplicate packet warnings.</span></span><br><span class="line">;mute-replay-warnings</span><br><span class="line"> </span><br><span class="line"><span class="comment"># SSL/TLS parms.</span></span><br><span class="line"><span class="comment"># See the server config file for more</span></span><br><span class="line"><span class="comment"># description. It's best to use</span></span><br><span class="line"><span class="comment"># a separate .crt/.key file pair</span></span><br><span class="line"><span class="comment"># for each client. A single ca</span></span><br><span class="line"><span class="comment"># file can be used for all clients.</span></span><br><span class="line">ca ca.crt    //指定CA证书的文件路径</span><br><span class="line">cert client.crt    //指定客户端的证书文件路径</span><br><span class="line">key client.key    //指定客户端的私钥文件路径</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Verify server certificate by checking that the</span></span><br><span class="line"><span class="comment"># certicate has the correct key usage set.</span></span><br><span class="line"><span class="comment"># This is an important precaution to protect against</span></span><br><span class="line"><span class="comment"># a potential attack discussed here:</span></span><br><span class="line"><span class="comment"># http://openvpn.net/howto.html#mitm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To use this feature, you will need to generate</span></span><br><span class="line"><span class="comment"># your server certificates with the keyUsage set to</span></span><br><span class="line"><span class="comment"># digitalSignature, keyEncipherment</span></span><br><span class="line"><span class="comment"># and the extendedKeyUsage to</span></span><br><span class="line"><span class="comment"># serverAuth</span></span><br><span class="line"><span class="comment"># EasyRSA can do this for you.</span></span><br><span class="line">remote-cert-tls server    //指定采用服务器校验方式</span><br><span class="line"> </span><br><span class="line"><span class="comment"># If a tls-auth key is used on the server</span></span><br><span class="line"><span class="comment"># then every client must also have the key.</span></span><br><span class="line">tls-auth ta.key 1    如果服务器设置了防御DoS等攻击的ta.key，则必须每个客户端开启；如果未设置，则注释掉这一行；</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Select a cryptographic cipher.</span></span><br><span class="line"><span class="comment"># If the cipher option is used on the server</span></span><br><span class="line"><span class="comment"># then you must also specify it here.</span></span><br><span class="line"><span class="comment"># Note that 2.4 client/server will automatically</span></span><br><span class="line"><span class="comment"># negotiate AES-256-GCM in TLS mode.</span></span><br><span class="line"><span class="comment"># See also the ncp-cipher option in the manpage</span></span><br><span class="line">cipher AES-256-CBC    //指定数据对称加密算法</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Enable compression on the VPN link.</span></span><br><span class="line"><span class="comment"># Don't enable this unless it is also</span></span><br><span class="line"><span class="comment"># enabled in the server config file.</span></span><br><span class="line"><span class="comment">#comp-lzo    //开启VPN连接压缩，与服务器端的保持一致</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Set log file verbosity.</span></span><br><span class="line">verb 3    //设置日志记录级别（0-9）</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Silence repeating messages</span></span><br><span class="line">;mute 20    //设置重复消息</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 如服务器上设置了linux系统账户或用户名密码认证则开启</span></span><br><span class="line">auth-user-pass    //启用用户名密码登陆认证方式</span><br></pre></td></tr></table></figure><p>也可将证书集成到客户端配置文件中，易于使用及传输</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ca ca.crt　　改为：;ca ca.crt</span><br><span class="line">cert client.crt　　改为：;cert client.crt</span><br><span class="line">key client.key　　改为：;key client.key</span><br><span class="line">tls-auth ta.key 1　　改为：;tls-auth ta.key 1</span><br><span class="line"> </span><br><span class="line">在最后面添加以下内容：</span><br><span class="line">&lt;ca&gt;</span><br><span class="line">ca.crt文件内容</span><br><span class="line">&lt;/ca&gt;</span><br><span class="line"> </span><br><span class="line">key-direction 1</span><br><span class="line">&lt;tls-auth&gt;</span><br><span class="line">ta.key文件内容</span><br><span class="line">&lt;/tls-auth&gt;</span><br><span class="line">&lt;cert&gt;</span><br><span class="line">client.crt文件内容</span><br><span class="line">&lt;/cert&gt;</span><br><span class="line">&lt;key&gt;</span><br><span class="line">client.key文件内容</span><br><span class="line">&lt;/key&gt;</span><br></pre></td></tr></table></figure><p>将client.ovpn文件拷贝到程序目录config下。</p><p>右键以管理员身份运行openvpn客户端软件（不以管理员运行可以出现连接后也不能访问的情况）稍后在桌面右下角灰色小图标处右击选择connect即可</p><h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>直接使用OpenVPN官方的OpenVPN Connect即可，选择import导入配置文件。</p><h4 id="Mac-OS-X"><a href="#Mac-OS-X" class="headerlink" title="Mac OS X"></a>Mac OS X</h4><p>使用第三方的Tunnelblick连接，注意根据你的操作系统版本选择合适的版本。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://www.yeboyzq.com/tag/openvpn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;OpenVPN&lt;/a&gt; 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。&lt;/p&gt;
&lt;p&gt;OpenVPN允许参与建立VPN的单点使用共享金钥，电子证书，或者用户名/密码来进行身份验证。它大量使用了OpenSSL加密库中的SSLv3/TLSv1 协议函式库。OpenVPN能在Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X与Windows 2000/XP/Vista上运行，并包含了许多安全性的功能。它并不是一个基于Web的VPN软件，也不与IPsec及其他VPN软件包兼容。&lt;/p&gt;
    
    </summary>
    
    
      <category term="linux" scheme="https://www.qazhe.com/tags/linux/"/>
    
      <category term="proxy" scheme="https://www.qazhe.com/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>Mac使用pyenv管理Python环境</title>
    <link href="https://www.qazhe.com/2020/03/03/Mac%E4%BD%BF%E7%94%A8pyenv%E7%AE%A1%E7%90%86Python%E7%8E%AF%E5%A2%83/"/>
    <id>https://www.qazhe.com/2020/03/03/Mac使用pyenv管理Python环境/</id>
    <published>2020-03-02T16:28:22.000Z</published>
    <updated>2020-03-02T16:23:42.001Z</updated>
    
    <content type="html"><![CDATA[<hr><p> Mac使用pyenv管理Python环境</p><a id="more"></a><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="https://github.com/yyuu/pyenv" target="_blank" rel="noopener">pyenv</a> 是 Python 版本管理工具。 pyenv 可以改变全局的 Python 版本，安装多个版本的 Python， 设置目录级别的 Python 版本，还能创建和管理 virtual python environments 。所有的设置都是用户级别的操作，不需要 sudo 命令。</p><p>pyenv 主要用来管理 Python 的版本，比如一个项目需要 Python 2.x ，一个项目需要 Python 3.x 。 而 virtualenv 主要用来管理 Python 包的依赖，不同项目需要依赖的包版本不同，则需要使用虚拟环境。</p><p>pyenv 通过系统修改环境变量来实现 Python 不同版本的切换。而 virtualenv 通过将 Python 包安装到一个目录来作为 Python 包虚拟环境，通过切换目录来实现不同包环境间的切换。</p><p>pyenv 的美好之处在于，它并没有使用将不同的 PATH植入不同的shell这种高耦合的工作方式，而是简单地在PATH植入不同的shell这种高耦合的工作方式，而是简单地在PATH 的最前面插入了一个垫片路径（shims）：~/.pyenv/shims:/usr/local/bin:/usr/bin:/bin。所有对 Python 可执行文件的查找都会首先被这个 shims 路径截获，从而使后方的系统路径失效。</p><h2 id="pyenv-安装"><a href="#pyenv-安装" class="headerlink" title="pyenv 安装"></a>pyenv 安装</h2><p>根据官网的 <a href="https://github.com/yyuu/pyenv#installation" target="_blank" rel="noopener">安装说明</a> 或者 <a href="https://github.com/yyuu/pyenv-installer" target="_blank" rel="noopener">自动安装</a> 。 如果使用 Mac 直接使用 Homebrew。安装成功后记得在 <code>.bashrc</code> 或者 <code>.bash_profile</code> 中添加三行来开启自动补全。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=&quot;$HOME/.pyenv/bin:$PATH&quot;</span><br><span class="line">eval &quot;$(pyenv init -)&quot;</span><br><span class="line">eval &quot;$(pyenv virtualenv-init -)&quot;</span><br></pre></td></tr></table></figure><p>根据自己的环境配置。</p><h3 id="自动安装"><a href="#自动安装" class="headerlink" title="自动安装"></a>自动安装</h3><p>pyenv 提供了自动安装的工具，执行命令安装即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.githubusercontent.com/yyuu/pyenv-installer/master/bin/pyenv-installer | bash</span><br></pre></td></tr></table></figure><p>保证系统有 git ，否则需要新安装 git。</p><h3 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h3><p>如果想要更加详细的了解安装过程，可以使用手动安装。将 pyenv 检出到你想安装的目录。建议路径为：$HOME/.pyenv</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">git clone git://github.com/yyuu/pyenv.git .pyenv</span><br><span class="line">echo &apos;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &apos;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &apos;eval &quot;$(pyenv init -)&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure><p>添加环境变量。<code>PYENV_ROOT</code> 指向 pyenv 检出的根目录，并向 $PATH 添加 <code>$PYENV_ROOT/bin</code> 以提供访问 pyenv 命令的路径。</p><p>这里的 shell 配置文件（~/.bash_profile）依不同 Linux 而需作修改，如果使用 Zsh 则需要相应的配置 <code>~/.zshrc</code></p><p>在使用 pyenv 之后使用 pip 安装的第三方模块会自动安装到当前使用 python 版本下，不会和系统模块产生冲突。使用 pip 安装模块之后，如果没有生效，记得使用 <code>pyenv rehash</code> 来更新垫片路径。</p><h2 id="pyenv-常用命令"><a href="#pyenv-常用命令" class="headerlink" title="pyenv 常用命令"></a>pyenv 常用命令</h2><p>使用 <code>pyenv commands</code> 显示所有可用命令</p><h3 id="查看本机安装-Python-版本"><a href="#查看本机安装-Python-版本" class="headerlink" title="查看本机安装 Python 版本"></a>查看本机安装 Python 版本</h3><p>使用如下命令查看本机安装版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv versions</span><br></pre></td></tr></table></figure><p>星号表示当前正在使用的 Python 版本。使用 <code>python -V</code> 确认版本。</p><h3 id="查看可安装-Python-版本"><a href="#查看可安装-Python-版本" class="headerlink" title="查看可安装 Python 版本"></a>查看可安装 Python 版本</h3><p>使用如下命令查看可安装版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyenv install -l</span><br></pre></td></tr></table></figure><h3 id="python-安装与卸载"><a href="#python-安装与卸载" class="headerlink" title="python 安装与卸载"></a>python 安装与卸载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv install 2.7.3   # 安装 python</span><br><span class="line">$ pyenv uninstall 2.7.3 # 卸载 python</span><br></pre></td></tr></table></figure><h3 id="python-切换"><a href="#python-切换" class="headerlink" title="python 切换"></a>python 切换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv global 2.7.3  # 设置全局的 Python 版本，通过将版本号写入 ~/.pyenv/version 文件的方式。</span><br><span class="line">$ pyenv local 2.7.3 # 设置 Python 本地版本，通过将版本号写入当前目录下的 .python-version 文件的方式。通过这种方式设置的 Python 版本优先级较 global 高。</span><br></pre></td></tr></table></figure><p>python 优先级</p><p>shell &gt; local &gt; global</p><p>pyenv 会从当前目录开始向上逐级查找 .python-version 文件，直到根目录为止。若找不到，就用 global 版本。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv shell 2.7.3 # 设置面向 shell 的 Python 版本，通过设置当前 shell 的 PYENV_VERSION 环境变量的方式。这个版本的优先级比 local 和 global 都要高。–unset 参数可以用于取消当前 shell 设定的版本。</span><br><span class="line">$ pyenv shell --unset</span><br><span class="line"></span><br><span class="line">$ pyenv rehash  # 创建垫片路径（为所有已安装的可执行文件创建 shims，如：~/.pyenv/versions/*/bin/*，因此，每当你增删了 Python 版本或带有可执行文件的包（如 pip）以后，都应该执行一次本命令）</span><br></pre></td></tr></table></figure><h2 id="pyenv-virtualenv"><a href="#pyenv-virtualenv" class="headerlink" title="pyenv-virtualenv"></a>pyenv-virtualenv</h2><p>pyenv 插件：pyenv-virtualenv</p><p>使用<strong>自动安装 pyenv</strong> 后，它会自动安装部分插件，通过 pyenv-virtualenv 插件可以很好的和 virtualenv 结合：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">einverne@ev  ~  cd ~/.pyenv/plugins</span><br><span class="line">einverne@ev  ~/.pyenv/plugins   master  ll</span><br><span class="line">total 24K</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-doctor</span><br><span class="line">drwxr-xr-x 5 einverne einverne 4.0K Apr 22 10:55 pyenv-installer</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-update</span><br><span class="line">drwxr-xr-x 7 einverne einverne 4.0K Apr 22 10:55 pyenv-virtualenv</span><br><span class="line">drwxr-xr-x 4 einverne einverne 4.0K Apr 22 10:55 pyenv-which-ext</span><br><span class="line">drwxr-xr-x 5 einverne einverne 4.0K Apr 22 10:54 python-build</span><br></pre></td></tr></table></figure><h3 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pyenv virtualenv 2.7.10 env-2.7.10</span><br></pre></td></tr></table></figure><p>若不指定 python 版本，会默认使用当前环境 python 版本。如果指定 Python 版本，则一定要是已经安装过的版本，否则会出错。环境的真实目录位于 ~/.pyenv/versions 下</p><h3 id="列出当前虚拟环境"><a href="#列出当前虚拟环境" class="headerlink" title="列出当前虚拟环境"></a>列出当前虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pyenv virtualenvs</span><br><span class="line">pyenv activate env-name  # 激活虚拟环境</span><br><span class="line">pyenv deactivate #退出虚拟环境，回到系统环境</span><br></pre></td></tr></table></figure><h3 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pyenv uninstall my-virtual-env</span><br><span class="line">rm -rf ~/.pyenv/versions/env-name  # 或者删除其真实目录</span><br></pre></td></tr></table></figure><p>使用 pyenv 来管理 python，使用 pyenv-virtualenv 插件来管理多版本 python 包。此时，还需注意，当我们将项目运行的 env 环境部署到生产环境时，由于我们的 python 包是依赖 python 的，需要注意生产环境的 python 版本问题。</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt; Mac使用pyenv管理Python环境&lt;/p&gt;
    
    </summary>
    
    
      <category term="mac" scheme="https://www.qazhe.com/tags/mac/"/>
    
      <category term="python" scheme="https://www.qazhe.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Scrcpy</title>
    <link href="https://www.qazhe.com/2020/01/30/Scrcpy/"/>
    <id>https://www.qazhe.com/2020/01/30/Scrcpy/</id>
    <published>2020-01-30T09:12:46.000Z</published>
    <updated>2020-01-30T10:22:17.253Z</updated>
    
    <content type="html"><![CDATA[<hr><p>Mac使用<code>Scrcpy</code>远程显示/控制Android手机</p><a id="more"></a><hr><h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ul><li>Android 5.0以上</li><li>启用 adb 调试（即 USB 调试）</li></ul><h2 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>安装方法：<a href="https://github.com/Genymobile/scrcpy/blob/master/BUILD.md" target="_blank" rel="noopener">手动安装说明</a>。不用担心，作为 Linux 用户，不难。</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>直接下载：</p><ul><li><a href="https://github.com/Genymobile/scrcpy/releases/download/v1.10/scrcpy-win32-v1.10.zip" target="_blank" rel="noopener"><code>scrcpy-win32-v1.10.zip</code></a><br><em>(SHA-256: f98b400b3764404b33b212e9762dd6f1593ddb766c1480fc2609c94768e4a8e1)</em></li><li><a href="https://github.com/Genymobile/scrcpy/releases/download/v1.10/scrcpy-win64-v1.10.zip" target="_blank" rel="noopener"><code>scrcpy-win64-v1.10.zip</code></a><br><em>(SHA-256: 95de34575d873c7e95dfcfb5e74d0f6af4f70b2a5bc6fde0f48d1a05480e3a44)</em></li></ul><h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>需要先安装 <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>，然后在终端中运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install scrcpy</span><br><span class="line">brew cask install android-platform-tools</span><br></pre></td></tr></table></figure><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="USB连接"><a href="#USB连接" class="headerlink" title="USB连接"></a>USB连接</h3><p>连接手机后使用控制台使用命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrcpy</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/feeloho/image_store/master/img/20200130181809.png" alt="demo"></p><h3 id="Wi-Fi-连接方式"><a href="#Wi-Fi-连接方式" class="headerlink" title="Wi-Fi 连接方式"></a>Wi-Fi 连接方式</h3><p>注意，要使用 Wi-Fi，仍然需要每次先用 USB 连接手机一次，实用性还不是特别高。</p><ol><li>将设备连接到与计算机相同的 Wi-Fi</li><li>获取手机 IP 地址（在设置→关于手机→状态）</li><li>启用 TCP/IP 上的 adb：<em>adb tcpip 5555</em></li><li>连接到您的设备：<em>adb connect 手机IP：5555</em></li><li>拔下手机</li><li>像往常一样运行 scrcpy</li></ol><p>要切换回USB模式：<em>adb usb</em></p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;Mac使用&lt;code&gt;Scrcpy&lt;/code&gt;远程显示/控制Android手机&lt;/p&gt;
    
    </summary>
    
    
      <category term="mac" scheme="https://www.qazhe.com/tags/mac/"/>
    
      <category term="andorid" scheme="https://www.qazhe.com/tags/andorid/"/>
    
  </entry>
  
  <entry>
    <title>centos 安装 vsftpd 以及 php 调用遇到的坑</title>
    <link href="https://www.qazhe.com/2019/04/01/centos-%E5%AE%89%E8%A3%85-vsftpd-%E4%BB%A5%E5%8F%8A-php-%E8%B0%83%E7%94%A8%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
    <id>https://www.qazhe.com/2019/04/01/centos-安装-vsftpd-以及-php-调用遇到的坑/</id>
    <published>2019-04-01T08:58:43.000Z</published>
    <updated>2019-05-05T02:24:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos 安装 vsftpd 以及 php 调用遇到的坑<br><a id="more"></a></p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">centsos 7.5</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>这里我直接使用 yum 的安装方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vsftpd</span><br></pre></td></tr></table></figure><p>如果需要连接其他 FTP 服务器，则可以安装 FTP 客户端。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ftp</span><br></pre></td></tr></table></figure><h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adduser userftp</span><br><span class="line">passwd userftp</span><br><span class="line"><span class="comment"># 禁止用户的 ssh 登录权限，只允许 FTP 访问:</span></span><br><span class="line">usermod -s /sbin/nologin userftp</span><br></pre></td></tr></table></figure><h2 id="配置-VSFTP"><a href="#配置-VSFTP" class="headerlink" title="配置 VSFTP"></a>配置 VSFTP</h2><p>路径: <code>/etc/vsftpd/vsftpd.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不允许匿名用户登录</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="comment"># 允许本地用户登录，即 linux 系统中的用户帐号登录FTP服务器</span></span><br><span class="line">local_enable=YES</span><br><span class="line"><span class="comment"># 是否允许本地用户对 FTP 服务器文件具有写权限</span></span><br><span class="line">write_enable=YES</span><br><span class="line"><span class="comment"># 或其它值，设置本地用户的文件掩码 为缺省022</span></span><br><span class="line">local_umask=022</span><br><span class="line"><span class="comment"># 允许匿名用户上传文件，须将 write_enable=YES</span></span><br><span class="line">anon_upload_enable=YES</span><br><span class="line"><span class="comment"># 允许匿名用户创建新文件夹</span></span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line"><span class="comment"># 激活目录欢迎信息功能</span></span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"><span class="comment"># 系统记录服务器上传和下载情况的日志文件，默认情况该日志文件为/var/log/vsftpd.log，也可以通过下面的 xferlog_file 选项对其进行设定</span></span><br><span class="line">xferlog_enable=YES</span><br><span class="line"><span class="comment"># 设定 FTP 服务器将启用 FTP 数据端口的连接请求 ,ftp-data 数据传输 ，21 为连接控制端口</span></span><br><span class="line">connect_from_port_20=YES</span><br><span class="line"><span class="comment"># 设定是否允许改变上传文件的属主，与下面一个设定项配合使用</span></span><br><span class="line">chown_uploads=YES</span><br><span class="line"><span class="comment"># 设置想要改变的上传文件的属主，如果需要，则输入一个系统用户名，例如可以把上传的文件都改成 root 属主。whoever：任何人</span></span><br><span class="line">chown_username=whoever</span><br><span class="line"><span class="comment"># 设定系统维护记录FTP服务器上传和下载情况的日志文件，/var/log/vsftpd.log是默认的，也可以另设其它</span></span><br><span class="line">xferlog_file=/var/<span class="built_in">log</span>/vsftpd.log</span><br><span class="line"><span class="comment"># 如果启用此选项，传输日志文件将以标准 xferlog 的格式书写，该格式的日志文件默认为/var/log/xferlog，也可以通过xferlog_file选项对其进行设定</span></span><br><span class="line">xferlog_std_format=YES</span><br><span class="line"><span class="comment"># 如果添加并启用此选项，将生成两个相似的日志文件，默认在/var/log/xferlog和/var/log/vsftpd.log目录下。前者是wu_ftpd类型的传输日志，可以利用标准日志工具对其进行分析；后者是vsftpd类型的日志</span></span><br><span class="line">dual_log_enable=YES</span><br><span class="line"><span class="comment"># 如果添加并启用此选项，则原本应该输出到/var/log/vsftpd.log中的日志，将输出到系统日志中</span></span><br><span class="line">syslog_enable=YES</span><br><span class="line"><span class="comment"># 设置数据传输中断间隔时间，此语句表示空闲的用户会话中断时间为600秒，即当数据传输结束后，用户连接FTP服务器的时间不应超过600秒，可以根据实际情况对该值进行修改</span></span><br><span class="line">idle_session_timeout=600</span><br><span class="line"><span class="comment"># 设置数据连接超时时间，该语句表示数据连接超时时间为 120 秒，可根据实际情况对其个修改</span></span><br><span class="line">data_connection_timeout=120</span><br><span class="line"><span class="comment"># 运行 vsftpd 需要的非特权系统用户，缺省是nobody</span></span><br><span class="line">nopriv_user=ftpsecure</span><br><span class="line"><span class="comment"># 如果 FTP client 会下达“async ABOR”这个指令时，这个设定才需要启用，而一般此设定并不安全，所以通常将其取消</span></span><br><span class="line">async_abor_enable=YES</span><br><span class="line"><span class="comment"># 大多数 FTP 服务器都选择用 ASCII 方式传输数据，用 ASCII 方式上传文件</span></span><br><span class="line">ascii_upload_enable=YES</span><br><span class="line"><span class="comment"># 用 ASCII 方式下载文件</span></span><br><span class="line">ascii_download_enable=YES</span><br><span class="line"><span class="comment"># 设置登录FTP服务器时显示的欢迎信息，可以修改=后的欢迎信息内容。另外如在需要设置更改目录欢迎信息的目录下创建名为 .message 的文件，并写入欢迎信息保存后，在进入到此目录会显示自定义欢迎信息</span></span><br><span class="line">ftpd_banner=Welcome to blah FTP service.</span><br><span class="line"><span class="comment"># 可将某些特殊的 email address 抵挡住。如果以anonymous登录服务器时，会要求输入密码，也就是您的email address,如果很讨厌某些email address，就可以使用此设定来取消他的登录权限，但必须与下面的设置项配合</span></span><br><span class="line">deny_email_enable=YES</span><br><span class="line"><span class="comment"># 当上面的 deny_email_enable=YES 时，可以利用这个设定项来规定那个email address不可登录vsftpd服务器，此文件需用户自己创建，一行一个email address即可</span></span><br><span class="line">banned_email_file=/etc/vsftpd/banned_emails</span><br><span class="line"><span class="comment"># 设置为 NO 时，用户登录FTP服务器后具有访问自己目录以外的其他文件的权限，设置为 YES 时，用户被锁定在自己的 home 目录中，vsftpd将在下面 chroot_list_file选项值的位置寻找 chroot_list文件，此文件需用户建立，再将需锁定在自己home目录的用户列入其中，每行一个用户</span></span><br><span class="line">chroot_list_enable=YES</span><br><span class="line"><span class="comment"># 此文件需自己建立，被列入此文件的用户，在登录后将不能切换到自己目录以外的其他目录，由 FTP 服务器自动地 chrooted 到用户自己的home目录下，使得 chroot_list文件中的用户不能随意转到其他用户的FTP home目录下，从而有利于FTP服务器的安全管理和隐私保护</span></span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line"><span class="comment"># 允许递归查询，大型站点的 FTP 服务器启用此项可以方便远程用户查询</span></span><br><span class="line">ls_recurse_enable=YES</span><br><span class="line"><span class="comment"># vsftpd 将以独立模式运行，由vsftpd自己监听和处理连接请求</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="comment"># 设定支持IPV6</span></span><br><span class="line">listen_ipv6=YES</span><br><span class="line"><span class="comment"># 设置 PAM 外挂模块提供的认证服务所使用的配置文件名，即/etc/pam.d/vsftpd文件，此文件中file=/etc/vsftpd/ftpusers字段，说明了PAM模块能抵挡的帐号内容来自文件/etc/vsftpd/ftpusers中</span></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="comment"># 默认NO，此时ftpusers文件中的用户禁止登录FTP服务器；若此项设为YES，则 user_list文件中的用户允许登录FTP服务器，而如果同时设置了 userlist_deny=YES，则user_list文件中的用户将不允许登录FTP服务器，甚至连输入密码提示信息都没有，直接被FTP服务器拒绝</span></span><br><span class="line">userlist_enable=YES/NO</span><br><span class="line"><span class="comment"># 默认YES，设置是否阻扯user_list文件中的用户登录FTP服务器</span></span><br><span class="line">userlist_deny=YES/NO</span><br><span class="line"><span class="comment"># 表明服务器使用 tcp_wrappers 作为主机访问控制方式，tcp_wrappers可以实现linux系统中网络服务的基于主机地址的访问控制，在/etc目录中的hosts.allow和hosts.deny两个文件用于设置tcp_wrappers的访问控制，前者设置允许访问记录，后者设置拒绝访问记录。例如想限制某些主机对FTP服务器192.168.57.2的匿名访问，编缉/etc/hosts.allow 文件，如在下面增加两行命令：vsftpd:192.168.57.1ENY 和vsftpd:192.168.57.9ENY 表明限制IP为192.168.57.1/192.168.57.9主机访问IP为192.168.57.2的FTP服务器，此时FTP服务器虽可以PING通，但无法连接</span></span><br><span class="line">tcp_wrappers=YES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对FTP客户机使用FTP服务器资源进行控制</span></span><br><span class="line"><span class="comment"># 设置FTP服务器所允许的最大客户端连接数，值为0时表示不限制。例如max_client=100表示FTP服务器的所有客户端最大连接数不超过100个</span></span><br><span class="line">max_client</span><br><span class="line"><span class="comment"># 设置对于同一IP地址允许的最大客户端连接数，值为0时表示不限制。例如max_per_ip=5表示同一IP地址的FTP客户机与FTP服务器建立的最大连接数不超过5个。 </span></span><br><span class="line">max_per_ip</span><br><span class="line"><span class="comment"># 设置本地用户的最大传输速率，单位为B/s，值为0时表示不限制。例如local_max_rate=500000表示FTP服务器的本地用户最大传输速率设置为500KB/s. </span></span><br><span class="line">local_max_rate</span><br><span class="line"><span class="comment"># 设置匿名用户的最大传输速率，单位为B/s,值为0表示不限制。例如ano_max_rate=200000，表示FTP服务器的匿名用户最大传输速率设置为200KB/s.</span></span><br><span class="line">anon_max_rate</span><br><span class="line"><span class="comment"># 解决时间不一致</span></span><br><span class="line">use_localtime=YES</span><br></pre></td></tr></table></figure><p>指定用户访问指定目录c<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">用户相关操作</span><br><span class="line">useradd -d /web-data/production-ftp -g ftp -s /sbin/nologin onelooks</span><br><span class="line">设置密码</span><br><span class="line">passwd onelooks</span><br><span class="line">用户删除</span><br><span class="line">userdel -r onelooks</span><br><span class="line"></span><br><span class="line">与该功能相关的选项主要包括：</span><br><span class="line">chroot_local_user</span><br><span class="line">chroot_list_enable</span><br><span class="line">chroot_list_file</span><br><span class="line">可以通过如下两种方法来设置chroot，从而杜绝上述不安全的情况发生：</span><br><span class="line">chroot_local_user=NO</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line">设置后，只有/etc/vsftpd.chroot_list文件中指定的用户不能返回上一层文件夹</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">chroot_list_enable=YES</span><br><span class="line">chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line">设置后，只有/etc/vsftpd.chroot_list文件中指定的用户可以返回上一层</span><br><span class="line">500 错误 可添加配置设置根目录写权限</span><br><span class="line">allow_writeable_chroot=YES</span><br></pre></td></tr></table></figure></p><p>启动服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service vsftpd start|stop|restart</span><br></pre></td></tr></table></figure><p>这里ftp服务器基本安装完成了, 下面怎么用php去连接它, 这也是我遇到的坑</p><h2 id="php使用"><a href="#php使用" class="headerlink" title="php使用"></a>php使用</h2><p>php提供了ftp的扩展, 直接编译安装就行了, <a href="https://www.jianshu.com/p/cfc9c044f886" target="_blank" rel="noopener">编译安装php-FTP扩展</a></p><p>下面是最坑的时候…</p><p>php上传文件的时候一直报<code>ftp_put(): Failed to establish connection.</code> 问题原因分析:</p><ol><li>防火墙, 阿里的安全组规则都开放21端口的访问, 如果 ftp 是主动模式就打开20端口,  被动模式则就打开<code>pasv_min_port</code>和<code>pasv_max_port</code>之间的端口</li><li>目录权限问题</li><li>ftp 配置<code>ascii_upload_enable</code>没有打开, 这个就是我导致错误的问题-_-!!!!</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;centos 安装 vsftpd 以及 php 调用遇到的坑&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>centos yum 安装mysql</title>
    <link href="https://www.qazhe.com/2019/02/02/centos-yum-%E5%AE%89%E8%A3%85mysql/"/>
    <id>https://www.qazhe.com/2019/02/02/centos-yum-安装mysql/</id>
    <published>2019-02-02T10:24:19.000Z</published>
    <updated>2019-03-01T11:11:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS 安装Mysql 5.7<br><a id="more"></a></p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>Linux版本：4.1.5-1.el7.centos.x86_64 (通过命令uname -a查看)</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum</span><br></pre></td></tr></table></figure><h3 id="安装源文件"><a href="#安装源文件" class="headerlink" title="安装源文件"></a>安装源文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-community-server-5.7.18-1.el7.x86_64.rpm</span><br></pre></td></tr></table></figure><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="官网下载对应版本"><a href="#官网下载对应版本" class="headerlink" title="官网下载对应版本"></a>官网下载对应版本</h3><p><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">官网下载 : MySQL Community Server 5.7.18</a><br>选择Select Operating System -&gt; Red Hat Enterprise Linux / Oracle Linux，由于自己Linux版本为4.1.5-1.el7.centos.x86_64，即: el7，所以选择：mysql-community-server-5.7.18-1.el7.x86_64.rpm 下载</p><h3 id="yum设置"><a href="#yum设置" class="headerlink" title="yum设置"></a>yum设置</h3><ul><li><a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener">官网下载 : RPM Package</a><br>选择mysql57-community-release-el7-10.noarch.rpm，下载，根据<a href="https://link.jianshu.com/?t=https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/" target="_blank" rel="noopener">A Quick Guide to Using the MySQL Yum Repository</a>设置yum</li><li><p>添加Mysql Yum Repository</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -Uvh mysql57-community-release-el7-10.noarch.rpm</span><br></pre></td></tr></table></figure></li><li><p>选择版本</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先看yum可以安装的mysql版本</span></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line"><span class="comment"># 可以通过编辑 /etc/yum.repos.d/mysql-community.repo文件进行修改安装版本</span></span><br><span class="line"><span class="comment"># 如果我们希望安装mysql 5.7版本，则需要把mysql 5.6版本取消，方法如下：</span></span><br><span class="line">vi  /etc/yum.repos.d/mysql-community.repo</span><br><span class="line"><span class="comment"># 修改mysql-community.repo如下部分</span></span><br><span class="line"><span class="comment">#将enabled设置为1，即安装5.7版本</span></span><br><span class="line">[mysql57-community]</span><br><span class="line">name=MySQL 5.7 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable to use MySQL 5.6 , 将enabled设置为0，即不安装5.6版本</span></span><br><span class="line">[mysql56-community]</span><br><span class="line">name=MySQL 5.6 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/6/<span class="variable">$basearch</span>/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql</span><br></pre></td></tr></table></figure><h3 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h3><ul><li><p>yum安装下载的mysql-community-server-5.7.18-1.el7.x86_64.rpm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql-community-server</span><br></pre></td></tr></table></figure></li><li><p>安装完毕-&gt;启动mysql</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo service mysqld start </span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过如下命令找到mysql root 初始密码</span></span><br><span class="line">sudo grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log </span><br><span class="line"><span class="comment"># 登录mysql</span></span><br></pre></td></tr></table></figure><p><a href="https://link.jianshu.com/?t=https://dev.mysql.com/doc/refman/5.7/en/linux-installation-rpm.html" target="_blank" rel="noopener">详见: 官网</a><br>登录mysql，修改密码（密码设置简单也会报错）<br>修改密码 : mysql 5.7和mysql 5.6修改密码命令不太相同，具体<a href="https://link.jianshu.com/?t=http://blog.itpub.net/29773961/viewspace-2077579/" target="_blank" rel="noopener">参见链接</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p&#123;初始随机密码&#125;</span><br><span class="line"><span class="comment"># 注意：此事必须修改密码才能正常使用mysql，否则任何操作都会报错</span></span><br><span class="line"><span class="comment"># 修改密码 : mysql 5.7和mysql 5.6修改密码命令不太相同</span></span><br><span class="line"><span class="comment"># 官方建议修改密码命令如下：</span></span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'new_password_复杂点的密码'</span>;</span><br></pre></td></tr></table></figure></p><h3 id="mysql远程登录"><a href="#mysql远程登录" class="headerlink" title="mysql远程登录"></a>mysql远程登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设有A和B两台机器，都安装有mysql，现在设置B机器可远程访问A机器mysql，配置方法如下：</span></span><br><span class="line"><span class="comment"># 进入机器A的mysql root账户，设置允许其他机器通过root账户远程访问本机mysql</span></span><br><span class="line">use mysql</span><br><span class="line">GRANT ALL ON *.* to root@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'your-root-password'</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以上设置成功后，可以从B机器上远程登录本机mysql，输入下面命令，可远程访问机器A：</span></span><br><span class="line">mysql -hA机器IP  -uroot  -pA机器root账户密码</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CentOS 安装Mysql 5.7&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux iptables配置</title>
    <link href="https://www.qazhe.com/2018/10/23/Linux-iptables%E9%85%8D%E7%BD%AE/"/>
    <id>https://www.qazhe.com/2018/10/23/Linux-iptables配置/</id>
    <published>2018-10-23T14:50:57.000Z</published>
    <updated>2018-10-23T15:06:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>在服务器中开启防火墙可以有效一些避免端口扫描和黑客攻击,所以配置iptables是非常有必要的.今天记录一下配置过程<br><a id="more"></a></p><h2 id="检查是否启动iptables"><a href="#检查是否启动iptables" class="headerlink" title="检查是否启动iptables"></a>检查是否启动iptables</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables status</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">/etc/init.d/iptables status</span><br></pre></td></tr></table></figure><p>如果显示如下，则说明iptables服务是有安装的，但是没有启动服务。<br>如果没有安装的话可以直接yum安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables: Firewall is not running.</span><br></pre></td></tr></table></figure></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y iptables</span><br></pre></td></tr></table></figure><p>生成配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></p><p>启动iptables<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service iptables start</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">/etc/init.d/iptables start</span><br><span class="line">iptables: Applying firewall rules:                         [  OK  ]</span><br></pre></td></tr></table></figure></p><p>查看当前iptables的配置情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">iptables -L -n</span><br><span class="line"><span class="comment">#会显示如下</span></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br></pre></td></tr></table></figure></p><p>如果显示这样就说明iptables服务已经启动了</p><h2 id="配置规则"><a href="#配置规则" class="headerlink" title="配置规则"></a>配置规则</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许对外请求的返回包</span></span><br><span class="line">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line"><span class="comment">#允许icmp包通过</span></span><br><span class="line">iptables -A INPUT -p icmp --icmp-type any -j ACCEPT</span><br><span class="line"><span class="comment">#允许来自于lo接口的数据包，如果没有此规则，将不能通过127.0.0.1访问本地服务</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#常用端口</span></span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 23 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 8080 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤所有非以上规则的请求</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果要添加内网ip信任（接受其所有TCP请求）</span></span><br><span class="line"><span class="comment">#注：(**.**.**.**)为IP,下同</span></span><br><span class="line">iptables -A INPUT -p tcp -s **.**.**.** -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#要封停一个IP，使用下面这条命令</span></span><br><span class="line">iptables -I INPUT -s **.**.**.** -j DROP</span><br><span class="line"><span class="comment">#要解封一个IP，使用下面这条命令</span></span><br><span class="line">iptables -D INPUT -s **.**.**.** -j DROP</span><br></pre></td></tr></table></figure><p>保存重启防火墙<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables save</span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><p>其他方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"><span class="comment"># 加入如下语句:</span></span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</span><br><span class="line"><span class="comment"># 保存（按Esc退出编辑）</span></span><br><span class="line">:wq</span><br><span class="line"><span class="comment"># 重启防火墙，修改完成</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><p>其他常用命令（不是一定要做）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许所有入栈规则</span></span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line"><span class="comment">#清空默认所有规则</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="comment">#清空自定义的所有规则</span></span><br><span class="line">iptables -X</span><br><span class="line"><span class="comment">#计数器置0</span></span><br><span class="line">iptables -Z</span><br></pre></td></tr></table></figure></p><h2 id="关闭端口"><a href="#关闭端口" class="headerlink" title="关闭端口"></a>关闭端口</h2><p>常用删除端口规则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前端口所在行数</span></span><br><span class="line">iptables -L -n --line-number</span><br><span class="line"><span class="comment"># 删除指定序列的端口（下面是删除第五条端口）</span></span><br><span class="line">iptables -D INPUT 5</span><br><span class="line"><span class="comment"># 确认是否已经删除，可以重新查看列表</span></span><br><span class="line">iptables -L -n --line-number</span><br></pre></td></tr></table></figure></p><p>其他方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">vim /etc/sysconfig/iptables </span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接删除对应端口的那句 ！！！！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存（按Esc退出编辑）</span></span><br><span class="line">:wq</span><br><span class="line"><span class="comment"># 重启防火墙，修改完成</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><p>保存规则，重启iptables服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#保存修改</span></span><br><span class="line">/etc/init.d/iptables save</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看规则是否添加成功</span></span><br><span class="line">vim /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加到iptables服务自启动</span></span><br><span class="line">chkconfig iptables on</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启iptables服务</span></span><br><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在服务器中开启防火墙可以有效一些避免端口扫描和黑客攻击,所以配置iptables是非常有必要的.今天记录一下配置过程&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>supervisor的使用与管理</title>
    <link href="https://www.qazhe.com/2018/10/08/supervisor%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%AE%A1%E7%90%86/"/>
    <id>https://www.qazhe.com/2018/10/08/supervisor的使用与管理/</id>
    <published>2018-10-08T08:49:54.000Z</published>
    <updated>2018-10-08T09:21:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>Supervisor <a href="http://supervisord.org/" target="_blank" rel="noopener">http://supervisord.org/</a>是用Python开发的一个client/server服务，是Linux/Unix系统下的一个进程管理工具，不支持Windows系统。它可以很方便的监听、启动、停止、重启一个或多个进程。用Supervisor管理的进程，当一个进程意外被杀死，supervisort监听到进程死后，会自动将它重新拉起，很方便的做到进程自动恢复的功能，不再需要自己写shell脚本来控制。<br><a id="more"></a></p><h2 id="安装Python-pip-安装"><a href="#安装Python-pip-安装" class="headerlink" title="安装Python pip 安装"></a>安装Python pip 安装</h2><p>python 第三方包的安装方法，此处不详细描述<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure></p><h2 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h2><p>supervisor的配置参数较多，下面介绍一下常用的参数配置，详细的配置及说明，请参考官方文档介绍。<br>注：分号（;）开头的配置表示注释<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[unix_http_server]</span><br><span class="line">file=/tmp/supervisor.sock   ;UNIX socket 文件，supervisorctl 会使用</span><br><span class="line">;chmod=0700                 ;socket文件的mode，默认是0700</span><br><span class="line">;chown=nobody:nogroup       ;socket文件的owner，格式：uid:gid</span><br><span class="line"> </span><br><span class="line">;[inet_http_server]         ;HTTP服务器，提供web管理界面</span><br><span class="line">;port=127.0.0.1:9001        ;Web管理后台运行的IP和端口，如果开放到公网，需要注意安全性</span><br><span class="line">;username=user              ;登录管理后台的用户名</span><br><span class="line">;password=123               ;登录管理后台的密码</span><br><span class="line"> </span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/tmp/supervisord.log ;日志文件，默认是 <span class="variable">$CWD</span>/supervisord.log</span><br><span class="line">logfile_maxbytes=50MB        ;日志文件大小，超出会rotate，默认 50MB，如果设成0，表示不限制大小</span><br><span class="line">logfile_backups=10           ;日志文件保留备份数量默认10，设为0表示不备份</span><br><span class="line">loglevel=info                ;日志级别，默认info，其它: debug,warn,trace</span><br><span class="line">pidfile=/tmp/supervisord.pid ;pid 文件</span><br><span class="line">nodaemon=<span class="literal">false</span>               ;是否在前台启动，默认是<span class="literal">false</span>，即以 daemon 的方式启动</span><br><span class="line">minfds=1024                  ;可以打开的文件描述符的最小值，默认 1024</span><br><span class="line">minprocs=200                 ;可以打开的进程数的最小值，默认 200</span><br><span class="line"> </span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///tmp/supervisor.sock ;通过UNIX socket连接supervisord，路径与unix_http_server部分的file一致</span><br><span class="line">;serverurl=http://127.0.0.1:9001 ; 通过HTTP的方式连接supervisord</span><br><span class="line"> </span><br><span class="line">; [program:xx]是被管理的进程配置参数，xx是进程的名称</span><br><span class="line">[program:xx]</span><br><span class="line"><span class="built_in">command</span>=/opt/apache-tomcat-8.0.35/bin/catalina.sh run  ; 程序启动命令</span><br><span class="line">autostart=<span class="literal">true</span>       ; 在supervisord启动的时候也自动启动</span><br><span class="line">startsecs=10         ; 启动10秒后没有异常退出，就表示进程正常启动了，默认为1秒</span><br><span class="line">autorestart=<span class="literal">true</span>     ; 程序退出后自动重启,可选值：[unexpected,<span class="literal">true</span>,<span class="literal">false</span>]，默认为unexpected，表示进程意外杀死后才重启</span><br><span class="line">startretries=3       ; 启动失败自动重试次数，默认是3</span><br><span class="line">user=tomcat          ; 用哪个用户启动进程，默认是root</span><br><span class="line">priority=999         ; 进程启动优先级，默认999，值小的优先启动</span><br><span class="line">redirect_stderr=<span class="literal">true</span> ; 把stderr重定向到stdout，默认<span class="literal">false</span></span><br><span class="line">stdout_logfile_maxbytes=20MB  ; stdout 日志文件大小，默认50MB</span><br><span class="line">stdout_logfile_backups = 20   ; stdout 日志文件备份数，默认是10</span><br><span class="line">; stdout 日志文件，需要注意当指定目录不存在时无法正常启动，所以需要手动创建目录（supervisord 会自动创建日志文件）</span><br><span class="line">stdout_logfile=/opt/apache-tomcat-8.0.35/logs/catalina.out</span><br><span class="line">stopasgroup=<span class="literal">false</span>     ;默认为<span class="literal">false</span>,进程被杀死时，是否向这个进程组发送stop信号，包括子进程</span><br><span class="line">killasgroup=<span class="literal">false</span>     ;默认为<span class="literal">false</span>，向进程组发送<span class="built_in">kill</span>信号，包括子进程</span><br><span class="line"> </span><br><span class="line">;包含其它配置文件</span><br><span class="line">[include]</span><br><span class="line">files = relative/directory/*.ini    ;可以指定一个或多个以.ini结束的配置文件</span><br></pre></td></tr></table></figure></p><p>include示例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[include]</span><br><span class="line">files = /opt/absolute/filename.ini /opt/absolute/*.ini foo.conf config??.ini</span><br></pre></td></tr></table></figure></p><h2 id="配置管理进程"><a href="#配置管理进程" class="headerlink" title="配置管理进程"></a>配置管理进程</h2><p>进程管理配置参数，不建议全都写在supervisord.conf文件中，应该每个进程写一个配置文件放在include指定的目录下包含进supervisord.conf文件中</p><ul><li>创建/etc/supervisor/config.d目录，用于存放进程管理的配置文件 </li><li>修改/etc/supervisor/supervisord.conf中的include参数，将/etc/supervisor/conf.d目录添加到include中<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/config.d/*.ini</span><br></pre></td></tr></table></figure></li></ul><h2 id="启动Supervisor服务"><a href="#启动Supervisor服务" class="headerlink" title="启动Supervisor服务"></a>启动Supervisor服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisord -c /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure><h2 id="Supervisorctl"><a href="#Supervisorctl" class="headerlink" title="Supervisorctl"></a>Supervisorctl</h2><p>supervisord启动成功后，可以通过supervisorctl客户端控制进程，启动、停止、重启。运行supervisorctl命令，不加参数，会进入supervisor客户端的交互终端，并会列出当前所管理的所有进程<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p><p>若成功，则会进入supervisorctl的shell界面，有以下方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">status    <span class="comment"># 查看程序状态</span></span><br><span class="line">stop xxx   <span class="comment"># 关闭 update_ip 程序</span></span><br><span class="line">start xxx  <span class="comment"># 启动 update_ip 程序</span></span><br><span class="line">restart xxx    <span class="comment"># 重启 update_ip 程序</span></span><br><span class="line">reread    ＃ 读取有更新（增加）的配置文件，不会启动新添加的程序</span><br><span class="line">update    ＃ 重启配置文件修改过的程序</span><br></pre></td></tr></table></figure></p><p>执行相关操作后，可以在web端看到具体的变化情况，如stop 程序<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop xxx</span><br></pre></td></tr></table></figure></p><h2 id="Web管理界面"><a href="#Web管理界面" class="headerlink" title="Web管理界面"></a>Web管理界面</h2><p>出于安全考虑，默认配置是没有开启web管理界面，需要修改supervisord.conf配置文件打开http访权限，将下面的配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;[inet_http_server]         ; inet (TCP) server disabled by default;port=127.0.0.1:9001        ; (ip_address:port specifier, *:port <span class="keyword">for</span> all iface);username=user              ; (default is no username (open server));password=123               ; (default is no password (open server))</span><br></pre></td></tr></table></figure></p><h2 id="开机启动Supervisor服务"><a href="#开机启动Supervisor服务" class="headerlink" title="开机启动Supervisor服务"></a>开机启动Supervisor服务</h2><h3 id="配置systemctl服务"><a href="#配置systemctl服务" class="headerlink" title="配置systemctl服务"></a>配置systemctl服务</h3><p>进入/lib/systemd/system目录，并创建supervisor.service文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">;port=127.0.0.1:9001        ; (ip_address:port specifier, *:port <span class="keyword">for</span> all iface)</span><br><span class="line">;username=user              ; (default is no username (open server))</span><br><span class="line">;password=123               ; (default is no password (open server))</span><br></pre></td></tr></table></figure></p><p>设置开机启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> supervisor.service</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></p><p>修改文件权限为766<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 766 supervisor.service</span><br></pre></td></tr></table></figure></p><h3 id="配置service类型服务"><a href="#配置service类型服务" class="headerlink" title="配置service类型服务"></a>配置service类型服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash## supervisord   This scripts turns supervisord on## Author:       Mike McGrath &lt;mmcgrath@redhat.com&gt; (based off yumupdatesd)## chkconfig:    - 95 04## description:  supervisor is a process control utility.  It has a web based#               xmlrpc interface as well as a few other nifty features.# processname:  supervisord# config: /etc/supervisor/supervisord.conf# pidfile: /var/run/supervisord.pid# # source function library. /etc/rc.d/init.d/functions RETVAL=0 start() &#123;    echo -n $"Starting supervisord: "    daemon "supervisord -c /etc/supervisor/supervisord.conf "    RETVAL=$?    echo    [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/supervisord&#125; stop() &#123;    echo -n $"Stopping supervisord: "    killproc supervisord    echo    [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/supervisord&#125; restart() &#123;    stop    start&#125; case "$1" in  start)    start    ;;  stop)     stop    ;;  restart|force-reload|reload)    restart    ;;  condrestart)    [ -f /var/lock/subsys/supervisord ] &amp;&amp; restart    ;;  status)    status supervisord    RETVAL=$?    ;;  *)    echo $"Usage: $0 &#123;start|stop|status|restart|reload|force-reload|condrestart&#125;"    exit 1esac exit $RETVAL</span></span><br></pre></td></tr></table></figure><p>将上述脚本内容保存到/etc/rc.d/init.d/supervisor文件中，修改文件权限为755，并设置开机启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /etc/rc.d/init.d/supervisor</span><br><span class="line">chkconfig supervisor on</span><br></pre></td></tr></table></figure></p><p>注意：修改脚本中supervisor配置文件路径为你的supervisor的配置文件路径</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Supervisor &lt;a href=&quot;http://supervisord.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://supervisord.org/&lt;/a&gt;是用Python开发的一个client/server服务，是Linux/Unix系统下的一个进程管理工具，不支持Windows系统。它可以很方便的监听、启动、停止、重启一个或多个进程。用Supervisor管理的进程，当一个进程意外被杀死，supervisort监听到进程死后，会自动将它重新拉起，很方便的做到进程自动恢复的功能，不再需要自己写shell脚本来控制。&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux Deploy:在Android上部署Linux</title>
    <link href="https://www.qazhe.com/2018/10/01/Linux-Deploy-%E5%9C%A8Android%E4%B8%8A%E9%83%A8%E7%BD%B2Linux/"/>
    <id>https://www.qazhe.com/2018/10/01/Linux-Deploy-在Android上部署Linux/</id>
    <published>2018-10-01T13:16:49.000Z</published>
    <updated>2018-10-01T13:31:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>android上部署linux服务器, 这里写这篇文章记录安装步骤<br><a id="more"></a></p><h2 id="安装-BusyBoxPro"><a href="#安装-BusyBoxPro" class="headerlink" title="安装 BusyBoxPro"></a>安装 BusyBoxPro</h2><p>github地址: <a href="https://github.com/meefik/busybox" target="_blank" rel="noopener">https://github.com/meefik/busybox</a></p><p>BusyBoxPro来扩展linux命令集，需要root，如果是小米的话需要解锁system分区。打开BusyBoxPro，授予root权限</p><h2 id="用LinuxDeploy开始安装linux"><a href="#用LinuxDeploy开始安装linux" class="headerlink" title="用LinuxDeploy开始安装linux"></a>用LinuxDeploy开始安装linux</h2><p>github: <a href="https://github.com/meefik/linuxdeploy" target="_blank" rel="noopener">https://github.com/meefik/linuxdeploy</a></p><h3 id="安装LinuxDeploy并授予root权限"><a href="#安装LinuxDeploy并授予root权限" class="headerlink" title="安装LinuxDeploy并授予root权限"></a>安装LinuxDeploy并授予root权限</h3><p><img src="http://pfpdww7l9.bkt.clouddn.com/15384002311620hhab25u.png?imageslim" alt="paste image"></p><h3 id="添加配置文件并设置属性"><a href="#添加配置文件并设置属性" class="headerlink" title="添加配置文件并设置属性"></a>添加配置文件并设置属性</h3><p>点击软件的左上角，在出现的菜单栏里点配置文件，再点➕创建新的配置文件，名称随意。创建完之后选中新建后的配置文件<br><img src="http://pfpdww7l9.bkt.clouddn.com/1538400274069imz4yo52.png?imageslim" alt="paste image"><br>建议都创建一个新的配置文件，这样出错的时候删除配置文件和系统就行了</p><p>Containerization method  //默认的就行<br>chroot</p><p>发行版    //根据自己的需要选择<br>CentOS</p><p>架构（Architecture）</p><p>这个我建议根据自己的手机CPU的架构来选择，不知道的可以在软件的主界面点右上角的按钮,选择状态<br><img src="http://pfpdww7l9.bkt.clouddn.com/1538400410378pj27ys7o.png?imageslim" alt="paste image"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[17:11:48] &gt;&gt;&gt; status</span><br><span class="line">[17:11:49] Device: MI 6</span><br><span class="line">[17:11:49] Android: 7.1.1</span><br><span class="line">[17:11:49] Architecture: aarch64           //这个就是架构</span><br><span class="line">[17:11:49] Kern el: 4.4.21-perf-g6a9ee37d-06151-g05a843</span><br></pre></td></tr></table></figure></p><p>还有就是如果选择Ubuntu时架构里没有这个aarch64，CPU是64位的就选择arm64，32位的就是arm，正常情况下是这样的，毕竟还有一些x86的CPU。<br>发行版版本(Distribution suit)：根据需要选择</p><p>源地址Source path ：选择了发行版后会自动填写为官方的源，可以换成其他源，也可以换成文件地址，用本地镜像或者Repository下载的系统包来安装。</p><p>安装类型：通常选择文件和目录两种方式。其中文件是创建一个img文件来当做系统的磁盘，目录的话是在这个软件的操作系统环境下创建一个目录直接存放系统文件。我建议如果不是建站的话选择文件，要存储东西或者建网站并且手机/date目录存储空间够的话可以选择目录。不过，就我安装了这么多次之后总结出来一条：选择目录出现错误的次数比选择文件的要多的多。出现错误最多的就是ssh没安装好。</p><p>安装路径：如果选择的是文件，那么这一项默认的是$EXTERNA<br>L_STORAGE:/linux.img，也就是/sdcard/linux.img。它是你的手机存储目录，你也可以指定任何一个存储路径；如果选择的是目录，那么它默认的是${ENV_DIR}/rootfs/linux。关于这个路径，最好不要更改，否则出现错误的几率会大大增加。</p><p>镜像大小和文件系统：如果选择的是文件，会让你选择这两项。文件大小最大2048M，也就是2G，文件系统选择自动就行。</p><p>用户名和密码：就是你之后用来登陆SSH的，自己随意填。</p><p>DNS服务器：可以不填，如果有需要可以填，个人比较倾向阿里的DNS，谷歌的也可以。</p><p>本地化：点开可以选择，中文的话就是zh_CN.UTF-8，英文的是en_US.UTF-8</p><p>下面那个MOUNTS如果勾选Enable的话要填写一个挂载点，比如/mnt/android，这样可以在Linux里访问手机存储里的内容了。</p><p>SSH这个必选吧，勾选之后就可以了。</p><p>图形界面：如果有需要可以勾选。</p><h3 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h3><p>配置完属性后就回到软件主界面，点击右上角按钮，选择安装，然后就会出现&gt;&gt;&gt;depoly</p><p>………………</p><p>………………</p><p>再一次出现&lt;&lt;&lt;depoly说明安装成功。这个过程的快慢看源地址的设置。如果设置的是网络上的源，会很慢，如果是本地的镜像很快就搞定了。</p><h3 id="启动Linux和停止"><a href="#启动Linux和停止" class="headerlink" title="启动Linux和停止"></a>启动Linux和停止</h3><p>安装完之后就可以点开始了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[18:06:24] &gt;&gt;&gt; start</span><br><span class="line">[18:06:25] Checking file system ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] Mounting partitions: </span><br><span class="line">[18:06:25] / ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /proc ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /sys ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /sys/fs/selinux ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /dev ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /dev/pts ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] /dev/shm ... <span class="keyword">done</span></span><br><span class="line">[18:06:25] :: Configuring core/mnt ... </span><br><span class="line">[18:06:25] :: Configuring core/net ... </span><br><span class="line">[18:06:26] :: Starting extra/ssh ... <span class="keyword">done</span></span><br><span class="line">[18:06:26] &lt;&lt;&lt; start</span><br></pre></td></tr></table></figure></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>上面说了一个ssh启动失败的问题，还有一个问题就是如果在安装的过程中出现<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[23:14:55] &gt;&gt;&gt; deploy</span><br><span class="line">[23:14:56] <span class="comment">## bootstrap/rootfs : do_install &amp;&amp; do_configure</span></span><br><span class="line">[23:14:56] The container is already mounted.</span><br><span class="line">[23:14:56] &lt;&lt;&lt; deploy</span><br></pre></td></tr></table></figure></p><p>其实这个很好解决，就是你已经启动了一个Linux系统，所以要点一下停止然后再安装。</p><p>本人暂时只遇到这一个问题, 如果有其它问题请联系本人, 共同折腾 (<em>^__^</em>) 嘻嘻</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;android上部署linux服务器, 这里写这篇文章记录安装步骤&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iptables</title>
    <link href="https://www.qazhe.com/2018/09/29/Linux%E4%B8%8Biptables%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3/"/>
    <id>https://www.qazhe.com/2018/09/29/Linux下iptables防火墙配置详解/</id>
    <published>2018-09-29T09:56:00.000Z</published>
    <updated>2018-09-29T09:58:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>Linux下iptables防火墙配置详解<br><a id="more"></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Linux下iptables防火墙配置详解&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="https://www.qazhe.com/categories/linux/"/>
    
    
      <category term="linux" scheme="https://www.qazhe.com/tags/linux/"/>
    
      <category term="iptables" scheme="https://www.qazhe.com/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>nginx-config</title>
    <link href="https://www.qazhe.com/2018/09/29/nginx-config/"/>
    <id>https://www.qazhe.com/2018/09/29/nginx-config/</id>
    <published>2018-09-29T06:13:00.000Z</published>
    <updated>2018-09-29T06:27:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>nginx 配置基础解释, 以后可能做一些更新<br><a id="more"></a></p><h2 id="nginx-基本配置"><a href="#nginx-基本配置" class="headerlink" title="nginx 基本配置"></a>nginx 基本配置</h2><h3 id="定义Nginx运行的用户和用户组-系统中必须有此用户-可以是nologin"><a href="#定义Nginx运行的用户和用户组-系统中必须有此用户-可以是nologin" class="headerlink" title="定义Nginx运行的用户和用户组,系统中必须有此用户,可以是nologin"></a>定义Nginx运行的用户和用户组,系统中必须有此用户,可以是nologin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user www www;</span><br></pre></td></tr></table></figure><h3 id="启动进程-通常设置成和cpu的数量相等"><a href="#启动进程-通常设置成和cpu的数量相等" class="headerlink" title="启动进程,通常设置成和cpu的数量相等"></a>启动进程,通常设置成和cpu的数量相等</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br></pre></td></tr></table></figure><h3 id="全局错误日志及PID文件"><a href="#全局错误日志及PID文件" class="headerlink" title="全局错误日志及PID文件"></a>全局错误日志及PID文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">error_log  /var/<span class="built_in">log</span>/nginx/error.log; <span class="comment">#错误日志定义等级，[ debug | info | notice | warn | error | crit ]</span></span><br><span class="line"> pid        /var/run/nginx.pid;</span><br></pre></td></tr></table></figure><p>一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worker_rlimit_nofile 65535;</span><br></pre></td></tr></table></figure></p><h3 id="工作模式及连接数上限"><a href="#工作模式及连接数上限" class="headerlink" title="工作模式及连接数上限"></a>工作模式及连接数上限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    use   epoll;             <span class="comment">#epoll是多路复用IO(I/O Multiplexing)中的一种方式,但是仅用于linux2.6以上内核,可以大大提高nginx的性能</span></span><br><span class="line">    worker_connections  1024;<span class="comment">#单个后台worker process进程的最大并发链接数 （最大连接数=连接数*进程数）</span></span><br><span class="line">    <span class="comment"># multi_accept on; </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="设定http服务器，利用它的反向代理功能提供负载均衡支持"><a href="#设定http服务器，利用它的反向代理功能提供负载均衡支持" class="headerlink" title="设定http服务器，利用它的反向代理功能提供负载均衡支持"></a>设定http服务器，利用它的反向代理功能提供负载均衡支持</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"><span class="comment">#设定mime类型,类型由mime.type文件定义</span></span><br><span class="line">include       /etc/nginx/mime.types;</span><br><span class="line">default_type  application/octet-stream;</span><br><span class="line"><span class="comment">#设定日志格式</span></span><br><span class="line">access_log    /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line"><span class="comment">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span></span><br><span class="line"><span class="comment">#必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span></span><br><span class="line">sendfile        on;</span><br><span class="line"><span class="comment">#tcp_nopush     on;</span></span><br><span class="line"><span class="comment">#连接超时时间</span></span><br><span class="line"><span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">keepalive_timeout  65;</span><br><span class="line">tcp_nodelay        on;</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启gzip压缩</span></span><br><span class="line">gzip  on;</span><br><span class="line">gzip_disable <span class="string">"MSIE [1-6]\.(?!.*SV1)"</span>;</span><br><span class="line"><span class="comment">#设定请求缓冲</span></span><br><span class="line">client_header_buffer_size    1k;</span><br><span class="line">large_client_header_buffers  4 4k;</span><br><span class="line"><span class="comment">#包含其它配置文件，如自定义的虚拟主机</span></span><br><span class="line">include /etc/nginx/conf.d/*.conf;</span><br><span class="line">include /etc/nginx/sites-enabled/*;</span><br></pre></td></tr></table></figure><h3 id="虚拟主机配置"><a href="#虚拟主机配置" class="headerlink" title="虚拟主机配置"></a>虚拟主机配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    <span class="comment">#侦听80端口</span></span><br><span class="line">    listen       80;</span><br><span class="line">    <span class="comment">#定义使用www.xx.com访问</span></span><br><span class="line">    server_name  www.xx.com;</span><br><span class="line">    <span class="comment">#设定本虚拟主机的访问日志</span></span><br><span class="line">    access_log  logs/www.xx.com.access.log  main;</span><br><span class="line">    <span class="comment">#默认请求</span></span><br><span class="line">    location / &#123;</span><br><span class="line">          root   /root;      <span class="comment">#定义服务器的默认网站根目录位置</span></span><br><span class="line">          index index.php index.html index.htm;   <span class="comment">#定义首页索引文件的名称</span></span><br><span class="line">          fastcgi_pass  www.xx.com;</span><br><span class="line">          fastcgi_param  SCRIPT_FILENAME  <span class="variable">$document_root</span>/<span class="variable">$fastcgi_script_name</span>; </span><br><span class="line">          include /etc/nginx/fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 定义错误提示页面</span></span><br><span class="line">    error_page   500 502 503 504 /50x.html;  </span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        root   /root;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#静态文件，nginx自己处理</span></span><br><span class="line">    location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">        root /var/www/virtual/htdocs;</span><br><span class="line">        <span class="comment">#过期30天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。</span></span><br><span class="line">        expires 30d;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.</span></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root /root;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        fastcgi_param SCRIPT_FILENAME /home/www/www<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">        include fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#设定查看Nginx状态的地址</span></span><br><span class="line">    location /NginxStatus &#123;</span><br><span class="line">        stub_status            on;</span><br><span class="line">        access_log              on;</span><br><span class="line">        auth_basic              <span class="string">"NginxStatus"</span>;</span><br><span class="line">        auth_basic_user_file  conf/htpasswd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#禁止访问 .htxxx 文件</span></span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="nginx的负载均衡和代理配置"><a href="#nginx的负载均衡和代理配置" class="headerlink" title="nginx的负载均衡和代理配置"></a>nginx的负载均衡和代理配置</h2><h3 id="设定http服务器，利用它的反向代理功能提供负载均衡支持-1"><a href="#设定http服务器，利用它的反向代理功能提供负载均衡支持-1" class="headerlink" title="设定http服务器，利用它的反向代理功能提供负载均衡支持"></a>设定http服务器，利用它的反向代理功能提供负载均衡支持</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"> <span class="comment">#设定mime类型,类型由mime.type文件定义</span></span><br><span class="line">include       /etc/nginx/mime.types;</span><br><span class="line">default_type  application/octet-stream;</span><br><span class="line"><span class="comment">#设定日志格式</span></span><br><span class="line">access_log    /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line"><span class="comment">#省略上文有的一些配置节点</span></span><br><span class="line"><span class="comment">#。。。。。。。。。。</span></span><br><span class="line"><span class="comment">#设定负载均衡的服务器列表</span></span><br><span class="line">upstream mysvr &#123;</span><br><span class="line">    <span class="comment">#weigth参数表示权值，权值越高被分配到的几率越大</span></span><br><span class="line">    server 192.168.8.1x:3128 weight=5;<span class="comment">#本机上的Squid开启3128端口</span></span><br><span class="line">    server 192.168.8.2x:80  weight=1;</span><br><span class="line">    server 192.168.8.3x:80  weight=6;</span><br><span class="line">&#125;</span><br><span class="line">upstream mysvr2 &#123;</span><br><span class="line">    <span class="comment">#weigth参数表示权值，权值越高被分配到的几率越大</span></span><br><span class="line">    server 192.168.8.x:80  weight=1;</span><br><span class="line">    server 192.168.8.x:80  weight=6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第一个虚拟服务器"><a href="#第一个虚拟服务器" class="headerlink" title="第一个虚拟服务器"></a>第一个虚拟服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    <span class="comment">#侦听192.168.8.x的80端口</span></span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  192.168.8.x;</span><br><span class="line">    <span class="comment">#对aspx后缀的进行负载均衡请求</span></span><br><span class="line">    location ~ .*\.aspx$ &#123;</span><br><span class="line">      root   /root;      <span class="comment">#定义服务器的默认网站根目录位置</span></span><br><span class="line">      index index.php index.html index.htm;   <span class="comment">#定义首页索引文件的名称</span></span><br><span class="line">      proxy_pass  http://mysvr ;<span class="comment">#请求转向mysvr 定义的服务器列表</span></span><br><span class="line">      <span class="comment">#以下是一些反向代理的配置.</span></span><br><span class="line">      proxy_redirect off;</span><br><span class="line">      <span class="comment">#后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span></span><br><span class="line">      proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">      proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">      proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">      client_max_body_size 10m;    <span class="comment">#允许客户端请求的最大单文件字节数</span></span><br><span class="line">      client_body_buffer_size 128k;  <span class="comment">#缓冲区代理缓冲用户端请求的最大字节数，</span></span><br><span class="line">      proxy_connect_timeout 90;  <span class="comment">#nginx跟后端服务器连接超时时间(代理连接超时)</span></span><br><span class="line">      proxy_send_timeout 90;        <span class="comment">#后端服务器数据回传时间(代理发送超时)</span></span><br><span class="line">      proxy_read_timeout 90;         <span class="comment">#连接成功后，后端服务器响应时间(代理接收超时)</span></span><br><span class="line">      proxy_buffer_size 4k;             <span class="comment">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span></span><br><span class="line">      proxy_buffers 4 32k;               <span class="comment">#proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span></span><br><span class="line">      proxy_busy_buffers_size 64k;    <span class="comment">#高负荷下缓冲大小（proxy_buffers*2）</span></span><br><span class="line">      proxy_temp_file_write_size 64k;  <span class="comment">#设定缓存文件夹大小，大于这个值，将从upstream服务器传</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nginx 配置基础解释, 以后可能做一些更新&lt;br&gt;
    
    </summary>
    
      <category term="后端" scheme="https://www.qazhe.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
      <category term="linux" scheme="https://www.qazhe.com/categories/%E5%90%8E%E7%AB%AF/linux/"/>
    
    
      <category term="nginx" scheme="https://www.qazhe.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>frp</title>
    <link href="https://www.qazhe.com/2018/09/27/frp/"/>
    <id>https://www.qazhe.com/2018/09/27/frp/</id>
    <published>2018-09-27T06:07:00.000Z</published>
    <updated>2018-09-27T06:22:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>frp 的使用及配置<br><a id="more"></a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>frp是中国开发者fatedier的作品，先看介绍<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frp 是一个高性能的反向代理应用，可以帮助您轻松地进行内网穿透，对外网提供服务，支持 tcp, udp, http, https 等协议类型，并且 web 服务支持根据域名进行路由转发。</span><br></pre></td></tr></table></figure></p><p>之前一直在路由器上使用ngrok，所以对frp一无所知。做渗透测试，需要NAT穿透，所以一直在找好用的工具，磨刀不误砍柴工。<br>尝试之后发现，frp用法和ngrok相似，但是frp比ngrok更加优秀。<br>配置过程很简单，但是也遇到一些问题，所以把过程记录下来。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>GitHub: <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">https://github.com/fatedier/frp</a> 下载对应操作系统版本</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="server端-查看帮助"><a href="#server端-查看帮助" class="headerlink" title="server端 查看帮助"></a>server端 查看帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@gorgiaxx:~<span class="comment"># frps -h</span></span><br><span class="line">frps is the server of frp</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    frps [-c config_file] [-L log_file] [--<span class="built_in">log</span>-level=&lt;log_level&gt;] [--addr=&lt;bind_addr&gt;]</span><br><span class="line">    frps [-c config_file] --reload</span><br><span class="line">    frps -h | --<span class="built_in">help</span></span><br><span class="line">    frps -v | --version</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -c config_file            <span class="built_in">set</span> config file</span><br><span class="line">    -L log_file               <span class="built_in">set</span> output <span class="built_in">log</span> file, including console</span><br><span class="line">    --<span class="built_in">log</span>-level=&lt;log_level&gt;   <span class="built_in">set</span> <span class="built_in">log</span> level: debug, info, warn, error</span><br><span class="line">    --addr=&lt;bind_addr&gt;        listen addr <span class="keyword">for</span> client, example: 0.0.0.0:7000</span><br><span class="line">    --reload                  reload ini file and configures <span class="keyword">in</span> common section won<span class="string">'t be changed</span></span><br><span class="line"><span class="string">    -h --help                 show this screen</span></span><br><span class="line"><span class="string">    -v --version              show version</span></span><br></pre></td></tr></table></figure><p>支持读取配置文件，所以我们直接看配置文件。作者给出的配置文件示例已经写的很详细了。所以配置起来非常方便</p><p>配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line"><span class="comment"># 支持IPv6，但是大陆网络情况下几乎不支持。这里填我们的IPv4地址，隧道端口7000</span></span><br><span class="line">bind_addr = 45.32.42.185</span><br><span class="line">bind_port = 7000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个就是http代理的端口，不要和nginx冲突，否则直接闪退。</span></span><br><span class="line">vhost_http_port = 8000</span><br><span class="line">vhost_https_port = 8443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制面板的访问端口，在这里我们可以看到隧道的使用情况</span></span><br><span class="line">dashboard_port = 7500</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制面板访问控制，请修改默认密码</span></span><br><span class="line">dashboard_user = your_name</span><br><span class="line">dashboard_pwd = your_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志记录路径，控制面板也能访问</span></span><br><span class="line">log_file = /var/<span class="built_in">log</span>/frps.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志级别，可选debug, info, warn, error。这里只需要warn，免得占空间。</span></span><br><span class="line">log_level = warn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志记录时间，不知道是不是支持自动清理，记录下warn日志就够了，也不需要清理。我觉得没必要记录warn以下的信息，就不管了</span></span><br><span class="line">log_max_days = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特权模式，开启之后，支持客户端预配置，也就是不用在服务端单独配置服务，为了示范，我还是下面加一点服务端预配置参数</span></span><br><span class="line">privilege_mode = <span class="literal">true</span></span><br><span class="line">privilege_token = your_privilege_token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 心跳包配置，默认30秒，超时应该就断开连接了</span></span><br><span class="line">heartbeat_timeout = 30</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定端口范围，特权模式下端口是客户端决定的，所以要在服务端做好限制，以免影响正常服务</span></span><br><span class="line">privilege_allow_ports = 2000-3000,3001,3003,4000-50000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大连接数</span></span><br><span class="line">max_pool_count = 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 认证超时</span></span><br><span class="line">authentication_timeout = 60</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子域名的根域名，就这样翻译吧</span></span><br><span class="line">subdomain_host = gorgiaxx.me</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个用作metasploit的reverse_tcp穿透，配好token就好</span></span><br><span class="line">[rev]</span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">auth_token = gorgiaxx</span><br><span class="line">bind_addr = 0.0.0.0</span><br><span class="line"><span class="comment"># ！！！注意，这里一定要看服务商是否把端口过滤了。vultr把4444端口过滤了害我折腾半天。</span></span><br><span class="line">listen_port = 4444</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个来代理web服务，用来传输payload</span></span><br><span class="line">[web]</span><br><span class="line"><span class="comment"># 如果要用http代理，必须至少在前面设定vhost_http_port这个参数。</span></span><br><span class="line"><span class="built_in">type</span> = http</span><br><span class="line">auth_token = gorgiaxx</span><br><span class="line"><span class="comment"># 子域名，最后的访问域名就是frp.gorgiaxx.me</span></span><br><span class="line">subdomain = frp</span><br></pre></td></tr></table></figure></p><h3 id="Client端-查看帮助"><a href="#Client端-查看帮助" class="headerlink" title="Client端 查看帮助"></a>Client端 查看帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">～$ frpc -h</span><br><span class="line">frpc is the client of frp</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    frpc [-c config_file] [-L log_file] [--<span class="built_in">log</span>-level=&lt;log_level&gt;] [--server-addr=&lt;server_addr&gt;]</span><br><span class="line">    frpc -h | --<span class="built_in">help</span></span><br><span class="line">    frpc -v | --version</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -c config_file              <span class="built_in">set</span> config file</span><br><span class="line">    -L log_file                 <span class="built_in">set</span> output <span class="built_in">log</span> file, including console</span><br><span class="line">    --<span class="built_in">log</span>-level=&lt;log_level&gt;     <span class="built_in">set</span> <span class="built_in">log</span> level: debug, info, warn, error</span><br><span class="line">    --server-addr=&lt;server_addr&gt; addr <span class="built_in">which</span> frps is listening <span class="keyword">for</span>, example: 0.0.0.0:7000</span><br><span class="line">    -h --<span class="built_in">help</span>                   show this screen</span><br><span class="line">    --version                   show version</span><br></pre></td></tr></table></figure><p>配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line"><span class="comment"># 服务器端口和地址</span></span><br><span class="line">server_addr = 45.32.42.185</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过http代理访问，一般情况下用不到</span></span><br><span class="line"><span class="comment"># http_proxy = http://user:pwd@192.168.1.128:8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志路径，客户端访问这个要root权限，后面加sudo运行吧。</span></span><br><span class="line">log_file = /var/<span class="built_in">log</span>/frpc.log</span><br><span class="line">log_level = warn</span><br><span class="line">log_max_days = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务指定给用户的token</span></span><br><span class="line">auth_token = gorgiaxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特权的token</span></span><br><span class="line">privilege_token = your_token</span><br><span class="line"></span><br><span class="line">[rev]</span><br><span class="line"><span class="comment"># tcp | http, default is tcp</span></span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 4444</span><br><span class="line"><span class="comment"># 加密通信，暂时不需要</span></span><br><span class="line">use_encryption = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 不是http的情况下，gzip压缩也不要</span></span><br><span class="line">use_gzip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[pre_rev]</span><br><span class="line"><span class="comment"># 预配置</span></span><br><span class="line">privilege_mode = <span class="literal">true</span></span><br><span class="line"><span class="built_in">type</span> = tcp</span><br><span class="line">local_ip = 0.0.0.0</span><br><span class="line">local_port = 5555</span><br><span class="line"><span class="comment"># 远程端口</span></span><br><span class="line">remote_port = 5555</span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line"><span class="built_in">type</span> = http</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 8080</span><br><span class="line">use_gzip = <span class="literal">true</span></span><br><span class="line">pool_count = 20</span><br><span class="line"><span class="comment"># 可以设定访问控制</span></span><br><span class="line"><span class="comment"># http_user = admin</span></span><br><span class="line"><span class="comment"># http_pwd = admin</span></span><br><span class="line"><span class="comment"># 子域名，最后就是frp.gorgiaxx.me</span></span><br><span class="line">subdomain = frp</span><br></pre></td></tr></table></figure></p><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>frp权限控制做的比较好，不怕端口暴露在公网。所以可以放心常驻后台</p><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup frps -c /etc/frps.ini &amp;</span><br></pre></td></tr></table></figure><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup frps -c /etc/frps.ini &amp;</span><br></pre></td></tr></table></figure><h3 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h3><p>直接浏览器访问 <a href="http://gorgiaxx.me:7500/" target="_blank" rel="noopener">http://gorgiaxx.me:7500/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;frp 的使用及配置&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>MySQL 8.0 在Windows zip 安装过程</title>
    <link href="https://www.qazhe.com/2018/07/26/mysql8-install/"/>
    <id>https://www.qazhe.com/2018/07/26/mysql8-install/</id>
    <published>2018-07-26T04:45:40.000Z</published>
    <updated>2018-07-26T10:20:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>mysql发布最新的8.0版本今天我们在Windows上面安装<br><a id="more"></a></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>下载地址社区版: <a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a></p><h3 id="解压zip包到安装目录"><a href="#解压zip包到安装目录" class="headerlink" title="解压zip包到安装目录"></a>解压zip包到安装目录</h3><p>比如我的安装目录是：D:\mysql-8.0.11-winx64</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>在Windows系统中，配置文件默认是安装目录下的 my.ini 文件，部分配置需要在初始安装时配置，大部分也可以在安装完成后进行更改。当然，极端情况下，所有的都是可以更改的。<br>在安装根目录下添加 my.ini，比如我这里是：D:\mysql-8.0.11-winx64\my.ini，写入基本配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment"># Remove leading # and set to the amount of RAM for the most important data</span></span><br><span class="line"><span class="comment"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span></span><br><span class="line"><span class="comment"># innodb_buffer_pool_size = 128M</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Remove leading # to turn on a very important data integrity option: logging</span></span><br><span class="line"><span class="comment"># changes to the binary log between backups.</span></span><br><span class="line"><span class="comment"># log_bin</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># These are commonly set, remove the # and set as required.</span></span><br><span class="line"><span class="attr">basedir</span> = D:\mysql-<span class="number">8.0</span>.<span class="number">11</span>-winx64</span><br><span class="line"><span class="attr">datadir</span> = D:\mysql-<span class="number">8.0</span>.<span class="number">11</span>-winx64</span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="comment"># server_id = .....</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Remove leading # to set options mainly useful for reporting servers.</span></span><br><span class="line"><span class="comment"># The server defaults are faster for transactions and fast SELECTs.</span></span><br><span class="line"><span class="comment"># Adjust sizes as needed, experiment to find the optimal values.</span></span><br><span class="line"><span class="comment"># join_buffer_size = 128M</span></span><br><span class="line"><span class="comment"># sort_buffer_size = 2M</span></span><br><span class="line"><span class="comment"># read_rnd_buffer_size = 2M </span></span><br><span class="line"> </span><br><span class="line"><span class="attr">sql_mode</span>=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span><br><span class="line"> </span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"> </span><br><span class="line"><span class="attr">performance_schema_max_table_instances</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">table_definition_cache</span> = <span class="number">400</span></span><br><span class="line"><span class="attr">table_open_cache</span> = <span class="number">256</span></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br></pre></td></tr></table></figure><p>注意，里面的 basedir 是我本地的安装目录，datadir 是我数据库数据文件要存放的位置，各项配置需要根据自己的环境进行配置。</p><p>查看所有的配置项，可参考：<a href="https://dev.mysql.com/doc/refman/8.0/en/mysqld-option-tables.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/mysqld-option-tables.html</a></p><h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><p>在MySQL安装目录的 bin 目录下执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --console</span><br></pre></td></tr></table></figure></p><p>执行完成后，会打印 root 用户的初始默认密码，比如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2018-04-20T02:35:01.507037Z 0 [Warning] [MY-010915] [Server] <span class="string">'NO_ZERO_DATE'</span>, <span class="string">'NO_ZERO_IN_DATE'</span> and <span class="string">'ERROR_FOR_DIVISION_BY_ZERO'</span> sql modes should be used with strict mode. They will be merged with strict mode <span class="keyword">in</span> a future release.</span><br><span class="line">2018-04-20T02:35:01.507640Z 0 [System] [MY-013169] [Server] D:\Program\MySQL8\bin\mysqld.exe (mysqld 8.0.11) initializing of server <span class="keyword">in</span> progress as process 11064</span><br><span class="line">2018-04-20T02:35:01.508173Z 0 [ERROR] [MY-010340] [Server] Error message file <span class="string">'D:\Program\MySQL\share\english\errmsg.sys'</span> had only 1090 error messages, but it should contain at least 4512 error messages. Check that the above file is the right version <span class="keyword">for</span> this program!</span><br><span class="line">2018-04-20T02:35:05.464644Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: APWCY5ws&amp;hjQ</span><br></pre></td></tr></table></figure></p><p>其中，第4行的“APWCY5ws&amp;hjQ”就是初始密码，在没有更改密码前，需要记住这个密码，后续登录需要用到。<br>要是你手贱，关快了，或者没记住，那也没事，删掉初始化的 datadir 目录，再执行一遍初始化命令，又会重新生成的。当然，也可以使用安全工具，强制改密码，用什么方法，自己随意。</p><p>参考：<a href="https://dev.mysql.com/doc/refman/8.0/en/data-directory-initialization-mysqld.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/data-directory-initialization-mysqld.html</a></p><h2 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h2><p>在MySQL安装目录的 bin 目录下执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">mysqld --install [服务名]</span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">mysqld --remove [服务名]</span><br></pre></td></tr></table></figure></p><p>后面的服务名可以不写，默认的名字为 mysql。当然，如果你的电脑上需要安装多个MySQL服务，就可以用不同的名字区分了，比如 mysql5 和 mysql8。<br>安装完成之后，就可以通过命令net start mysql启动MySQL的服务了。</p><p>参考：<a href="https://dev.mysql.com/doc/refman/8.0/en/windows-start-service.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/windows-start-service.html</a></p><h2 id="更改密码和密码认证插件"><a href="#更改密码和密码认证插件" class="headerlink" title="更改密码和密码认证插件"></a>更改密码和密码认证插件</h2><p>在MySQL安装目录的 bin 目录下执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></p><p>这时候会提示输入密码，记住了第3步的密码，填入即可登录成功，进入MySQL命令模式。<br>在MySQL8.0.4以前，执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PASSWORD=PASSWORD(<span class="string">'[修改的密码]'</span>);</span><br></pre></td></tr></table></figure></p><p>就可以更改密码，但是MySQL8.0.4开始，这样默认是不行的。因为之前，MySQL的密码认证插件是“mysql_native_password”，而现在使用的是“caching_sha2_password”。</p><p>因为当前有很多数据库工具和链接包都不支持“caching_sha2_password”，为了方便，我暂时还是改回了“mysql_native_password”认证插件。</p><p>在MySQL中执行命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'password'</span>;</span><br></pre></td></tr></table></figure></p><p>修改密码验证插件，同时修改密码。</p><p>如果想默认使用“mysql_native_password”插件认证，可以在配置文件中配置default_authentication_plugin项。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">default_authentication_plugin</span>=mysql_native_password</span><br></pre></td></tr></table></figure></p><p>附、CentOS tar.gz 包安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget https://cdn.mysql.com//Downloads/MySQL-8.0/mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">shell&gt; tar zxvf mysql-8.0.11-linux-glibc2.12-x86_64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line">shell&gt; groupadd mysql</span><br><span class="line">shell&gt; useradd -r -g mysql -s /bin/<span class="literal">false</span> mysql</span><br><span class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span></span><br><span class="line">shell&gt; ln -s mysql-8.0.11-linux-glibc2.12-x86_64 mysql</span><br><span class="line">shell&gt; <span class="built_in">cd</span> mysql</span><br><span class="line">shell&gt; mkdir mysql-files</span><br><span class="line">shell&gt; chown mysql:mysql mysql-files</span><br><span class="line">shell&gt; chmod 750 mysql-files</span><br><span class="line">shell&gt; bin/mysqld --initialize --user=mysql</span><br><span class="line">shell&gt; bin/mysql_ssl_rsa_setup</span><br><span class="line">shell&gt; bin/mysqld_safe --user=mysql &amp;</span><br><span class="line"><span class="comment"># Next command is optional</span></span><br><span class="line">shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mysql发布最新的8.0版本今天我们在Windows上面安装&lt;br&gt;
    
    </summary>
    
      <category term="mysql" scheme="https://www.qazhe.com/categories/mysql/"/>
    
    
      <category term="mysql" scheme="https://www.qazhe.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>phpstorm增加swoole自动提示</title>
    <link href="https://www.qazhe.com/2018/07/02/phpstorm%E5%A2%9E%E5%8A%A0swoole%E8%87%AA%E5%8A%A8%E6%8F%90%E7%A4%BA/"/>
    <id>https://www.qazhe.com/2018/07/02/phpstorm增加swoole自动提示/</id>
    <published>2018-07-02T09:58:05.000Z</published>
    <updated>2018-07-02T10:08:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>phpstorm增加swoole自动提示<br><a id="more"></a></p><h3 id="下载swoole-ide-helper-en"><a href="#下载swoole-ide-helper-en" class="headerlink" title="下载swoole-ide-helper-en"></a>下载swoole-ide-helper-en</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/eaglewu/swoole-ide-helper.git</span><br></pre></td></tr></table></figure><h3 id="打开PHPStorm"><a href="#打开PHPStorm" class="headerlink" title="打开PHPStorm"></a>打开PHPStorm</h3><p><img src="https://img-blog.csdn.net/20170928233308966?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGNxaW5nZmVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p><h3 id="右键External-Libraries，选择Configure-PHP-Include-Path"><a href="#右键External-Libraries，选择Configure-PHP-Include-Path" class="headerlink" title="右键External Libraries，选择Configure PHP Include Path"></a>右键External Libraries，选择Configure PHP Include Path</h3><p><img src="https://img-blog.csdn.net/20170928233609955?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGNxaW5nZmVuZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="此处输入图片的描述"></p><p>选择下载好的swoole-ide-helper目录，点击确定。<br>然后就会发现代码中swoole相关方法函数不再反白了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;phpstorm增加swoole自动提示&lt;br&gt;
    
    </summary>
    
    
      <category term="php" scheme="https://www.qazhe.com/tags/php/"/>
    
      <category term="swoole" scheme="https://www.qazhe.com/tags/swoole/"/>
    
      <category term="phpstorm" scheme="https://www.qazhe.com/tags/phpstorm/"/>
    
  </entry>
  
  <entry>
    <title>hexo 如何添加和发表文章</title>
    <link href="https://www.qazhe.com/2018/06/24/hexo%20%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%8F%91%E8%A1%A8%E6%96%87%E7%AB%A0/"/>
    <id>https://www.qazhe.com/2018/06/24/hexo 如何添加和发表文章/</id>
    <published>2018-06-24T06:32:46.000Z</published>
    <updated>2018-09-27T07:29:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>如何在hexo发布一篇文章<br><a id="more"></a><br>1.本地写文章<br>选中你的Blog文件夹(我这里选择的是我自己重命名过的),鼠标右键单击，选择Git Bash Here<br><img src="https://ws1.sinaimg.cn/mw690/005vwoCyly1fn7sob24o7j30b00ajt9k.jpg" alt="此处输入图片的描述"></p><p>1.1 新建文章<br>输入指令hexo new XXX 如下图xxx为文章标题，根据自己情况写。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7srydq0fj30cv01nq2t.jpg" alt="此处输入图片的描述"></p><p>完成后会提示 在…/Blog/source/_post/目录下创建了xxx.md</p><p>1.2 写文章<br>我们根据提示的目录，找到这个文件，然后使用编辑器打开。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7sx0jdg7j30h8057gma.jpg" alt="此处输入图片的描述"></p><p>我这里使用的是Sublime,你可以使用自己喜欢的编辑器。<br>打开后如图所示，可以开始写文章了,写完后请Ctrl+S保存。<br><img src="https://ws1.sinaimg.cn/mw690/005vwoCyly1fn7sz7kug4j30v80i4tc4.jpg" alt="此处输入图片的描述"></p><p>关于Markdown可以看我这篇文章<a href="https://mapan.tech/posts/b33e.html" target="_blank" rel="noopener">Markdown语法和MD编辑器</a></p><p>1.3如何在文章插入图片？<br>可以看我这篇文章 <a href="https://mapan.tech/posts/c9c3.html" target="_blank" rel="noopener">使Hexo文章图文并茂</a></p><p>2.本地预览 (非必要，可选)<br>在编辑文章过程中，我们肯定不想频繁的部署，查看效果。这时候使用hexo s指令进行本地预览，文章编辑完成，且自己满意后，再进行部署。<br>提示INFO Hexo is running at <a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a>. Press Ctrl+C to stop.<br>这句信息含义是“网站已经运行在本地 <a href="http://locahost:4000/" target="_blank" rel="noopener">http://locahost:4000/</a> ,按Ctrl+C可以停止预览”。<br>我们不要按Ctrl+C，现在直接浏览器打开 <a href="http://locahost:4000/" target="_blank" rel="noopener">http://locahost:4000/</a> 即可看到预览效果。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7tv4nqsoj30fw09zgmi.jpg" alt="此处输入图片的描述"></p><p>3.渲染并部署网站<br>3.1 hexo g渲染生成网站<br>现在我们文章已经写好，预览也比较满意。现在可以Ctrl+C停止预览，然后hexo g渲染出整套网站代码(你可以在../Blog/public/文件夹下看到整套网站的代码)。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7t2ivla5j30g705ijrj.jpg" alt="此处输入图片的描述"></p><p>渲染完成后，info提示信息:使用2.01秒生成了74个文件,这表示完成了渲染。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7t59khztj30g609bglx.jpg" alt="此处输入图片的描述"></p><p>3.2 hexo d部署网站(把渲染好的html等网站文件，上传到Coding服务器)<br>如图，除了黄色框框内的信息或许没有，其他都应该有。<br><img src="https://ws1.sinaimg.cn/large/005vwoCyly1fn7tdc765xj30g40h3ab4.jpg" alt="此处输入图片的描述"></p><p>最后一句INFO Deploy done: git表示部署已完成。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;如何在hexo发布一篇文章&lt;br&gt;
    
    </summary>
    
      <category term="hexo" scheme="https://www.qazhe.com/categories/hexo/"/>
    
    
      <category term="hexo" scheme="https://www.qazhe.com/tags/hexo/"/>
    
  </entry>
  
</feed>
